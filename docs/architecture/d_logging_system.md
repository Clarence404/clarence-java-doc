# 日志架构设计

## 成熟的日志存储方案总览

- 日志系统 = 采集 + 传输 + 存储 + 查询
- 下面只聚焦 存储 + 查询层（成熟、被大规模验证过的）。

这个问题问得**非常标准，也很“架构向”** 👍
我直接给你一个**成熟日志存储方案的全景图**，按**类型 + 适用场景**来分，方便你后面写文档或做选型。

---

# 成熟的日志存储方案总览

> 日志系统 = **采集 + 传输 + 存储 + 查询**
> 下面只聚焦 **存储 + 查询层**（成熟、被大规模验证过的）。

---

## 一、搜索型日志存储（最常见）

### 1️⃣ Elasticsearch / OpenSearch（ELK）

**成熟度：⭐⭐⭐⭐⭐**

**代表：**

* Elasticsearch
* OpenSearch（AWS / 开源替代）

**特点：**

* 强全文检索
* 聚合能力强
* 生态成熟（Kibana / Beats）

**优点：**

* 模糊查询、聚合、统计都很强
* 非常适合运维 / 排障 / 业务分析

**缺点：**

* 成本高
* 索引设计复杂
* 高基数字段容易炸

**适合场景：**

* 中大型系统
* 查询复杂、分析型日志
* 多维度日志分析

---

## 二、云厂商托管日志（省心型）

### 2️⃣ AWS CloudWatch Logs

**成熟度：⭐⭐⭐⭐⭐**

**特点：**

* 全托管
* 按扫描量计费
* 和 AWS 服务深度集成

**优点：**

* 零运维
* 天然高可用
* 权限体系完善

**缺点：**

* 查询贵
* 大范围查询容易卡
* 查询语法有限

**适合场景：**

* 全 AWS 架构
* 中小团队
* 运维人力有限

---

### 3️⃣ 阿里云 SLS（Log Service）

**成熟度：⭐⭐⭐⭐⭐**

**特点：**

* 类 ELK 体验
* 云厂商优化过的日志系统

**优点：**

* 性能好
* 成本可控
* 可视化完善

**缺点：**

* 强绑定云厂商

**适合场景：**

* 阿里云生态
* 国内业务

---

## 三、时间序列 / 标签型日志（新趋势）

### 4️⃣ Grafana Loki

**成熟度：⭐⭐⭐⭐**

**特点：**

* 日志 ≈ 指标
* 只索引标签，不索引全文

**优点：**

* 成本极低
* 与 Prometheus / Grafana 深度集成

**缺点：**

* 不适合复杂全文搜索
* 依赖标签设计

**适合场景：**

* Kubernetes
* 高日志量、低查询复杂度
* 可观测性体系

---

## 四、对象存储型（低成本归档）

### 5️⃣ S3 / OSS + Athena / Trino

**成熟度：⭐⭐⭐⭐**

**特点：**

* 日志当文件存
* 按需分析

**优点：**

* 极低存储成本
* 无限扩展
* 非常适合长期留存

**缺点：**

* 查询慢
* 实时性差

**适合场景：**

* 合规审计
* 历史日志
* 离线分析

---

## 六、常见组合方案（真实生产最常见）

### ⭐ 推荐组合 1（性价比）

```
Loki + Grafana
```

### ⭐ 推荐组合 2（分析能力最强）

```
ELK / OpenSearch
```

### ⭐ 推荐组合 3（云原生）

```
CloudWatch Logs + S3
```

### ⭐ 推荐组合 4（冷热分层）

```
ELK（7天） + S3（长期）
```

---

## 七、快速选型建议

| 场景   | 推荐                |
|------|-------------------|
| 查询复杂 | Elasticsearch     |
| 成本敏感 | Loki              |
| 云托管  | CloudWatch        |
| 长期归档 | S3                |
| K8s  | Loki + Prometheus |
