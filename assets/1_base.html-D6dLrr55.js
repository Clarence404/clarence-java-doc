import{_ as c,c as o,a as l,b as s,d as a,e,f as p,r as i,o as u}from"./app-BYPbKU-O.js";const r="/clarence-java-doc/assets/hashmap_hash_conflict-DfcWWAIJ.png",d="/clarence-java-doc/assets/LinkedHashMap-uNfJhtFw.png",k="/clarence-java-doc/assets/TreeMap-RKRumpct.png",v="/clarence-java-doc/assets/volatile-Bf3yqia0.png",h="/clarence-java-doc/assets/command_reformat-bUm8VFxM.png",m="/clarence-java-doc/assets/singleton_double_check-CQ3424ap.png",b="/clarence-java-doc/assets/threadlocal_usage-DJvxl6vh.png",g="/clarence-java-doc/assets/threadlocal_structure-Chz4M1CP.png",y={};function f(w,n){const t=i("RouteLink");return u(),o("div",null,[n[29]||(n[29]=l('<h1 id="java-åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#java-åŸºç¡€"><span>Java åŸºç¡€</span></a></h1><ul><li>APIåœ°å€ï¼š<a href="https://docs.oracle.com/en/java/javase/" target="_blank" rel="noopener noreferrer">https://docs.oracle.com/en/java/javase/</a></li><li>æºç åœ°å€ï¼š<a href="https://github.com/openjdk" target="_blank" rel="noopener noreferrer">https://github.com/openjdk</a></li></ul><h2 id="ä¸€ã€hashmapåˆ†æ" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€hashmapåˆ†æ"><span>ä¸€ã€Hashmapåˆ†æ</span></a></h2><p>HashMap æ˜¯ä¸€ç§åŸºäºå“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„ï¼Œå®ƒå®ç°äº† Map æ¥å£ï¼Œç”¨äºå­˜å‚¨é”®å€¼å¯¹ (key-value)ã€‚å…¶åŸºæœ¬åŸç†å¦‚ä¸‹ï¼š</p><h3 id="_1ã€å“ˆå¸Œè¡¨-hash-table" tabindex="-1"><a class="header-anchor" href="#_1ã€å“ˆå¸Œè¡¨-hash-table"><span>1ã€å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰</span></a></h3><p>HashMap æ˜¯åŸºäºå“ˆå¸Œè¡¨å®ç°çš„ï¼Œå“ˆå¸Œè¡¨çš„åŸºæœ¬æ€æƒ³æ˜¯é€šè¿‡å°†æ•°æ®çš„é”®å€¼å¯¹æ˜ å°„åˆ°ä¸€ä¸ªæ•°ç»„çš„ç´¢å¼•ä½ç½®ä¸Šæ¥æé«˜æ•°æ®æŸ¥æ‰¾çš„æ•ˆç‡ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>',6)),s("ul",null,[n[3]||(n[3]=s("li",null,[s("p",null,[s("strong",null,"å“ˆå¸Œå‡½æ•°"),a("ï¼š HashMap ä½¿ç”¨å“ˆå¸Œå‡½æ•°å°†é”®ï¼ˆkeyï¼‰æ˜ å°„åˆ°æ•°ç»„çš„ç´¢å¼•ä½ç½®ã€‚å“ˆå¸Œå‡½æ•°çš„ç›®çš„æ˜¯é€šè¿‡è®¡ç®—ä¸€ä¸ªå€¼ï¼Œå°†ä¸åŒçš„é”®æ˜ å°„åˆ°å“ˆå¸Œè¡¨ä¸­çš„ä½ç½®ã€‚")])],-1)),s("li",null,[n[1]||(n[1]=s("p",null,[s("strong",null,"æ•°ç»„"),a("ï¼š å“ˆå¸Œè¡¨å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªæ•°ç»„æ¥å­˜å‚¨æ•°æ®ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å­˜å‚¨ä¸€ä¸ªé“¾è¡¨ï¼ˆæˆ–è€…åœ¨ Java 8 åæ˜¯")],-1)),e(t,{to:"/algorithm/0_base_4_tree#çº¢é»‘æ ‘-balanced-binary-search-tree-bbst"},{default:p(()=>n[0]||(n[0]=[a("çº¢é»‘æ ‘")])),_:1}),n[2]||(n[2]=a("ï¼‰ï¼Œç”¨äºå¤„ç†å“ˆå¸Œå†²çªã€‚"))])]),n[30]||(n[30]=s("h3",{id:"_2ã€å“ˆå¸Œå†²çª",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_2ã€å“ˆå¸Œå†²çª"},[s("span",null,"2ã€å“ˆå¸Œå†²çª")])],-1)),n[31]||(n[31]=s("p",null,"ç”±äºå“ˆå¸Œå‡½æ•°ä¸å¯èƒ½åšåˆ°å®Œå…¨å”¯ä¸€çš„æ˜ å°„ï¼Œä¸åŒçš„é”®å¯èƒ½ä¼šè¢«æ˜ å°„åˆ°ç›¸åŒçš„ç´¢å¼•ï¼Œè¿™ç§æƒ…å†µç§°ä¸ºå“ˆå¸Œå†²çªã€‚HashMap é€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³å“ˆå¸Œå†²çªï¼š",-1)),s("ul",null,[s("li",null,[s("p",null,[n[5]||(n[5]=s("strong",null,"é“¾è¡¨æ³•ï¼ˆé“¾å¼å“ˆå¸Œï¼‰",-1)),n[6]||(n[6]=a("ï¼š åœ¨å‘ç”Ÿå†²çªçš„æƒ…å†µä¸‹ï¼ŒHashMap ä¼šå°†å†²çªçš„é”®å€¼å¯¹å­˜å‚¨åˆ°ä¸€ä¸ªé“¾è¡¨ä¸­ ï¼ˆæˆ–è€… ")),e(t,{to:"/algorithm/0_base_4_tree#çº¢é»‘æ ‘-balanced-binary-search-tree-bbst"},{default:p(()=>n[4]||(n[4]=[a("çº¢é»‘æ ‘")])),_:1}),n[7]||(n[7]=a("ï¼‰ã€‚ å½“å¤šä¸ªå…ƒç´ æ˜ å°„åˆ°åŒä¸€ä¸ªç´¢å¼•ä½ç½®æ—¶ï¼Œå®ƒä»¬ä¼šå½¢æˆä¸€ä¸ªé“¾è¡¨ã€‚"))])]),s("li",null,[s("p",null,[s("strong",null,[e(t,{to:"/algorithm/0_base_4_tree#çº¢é»‘æ ‘-balanced-binary-search-tree-bbst"},{default:p(()=>n[8]||(n[8]=[a("çº¢é»‘æ ‘")])),_:1}),n[9]||(n[9]=a(" æ³•"))]),n[11]||(n[11]=a("ï¼š åœ¨ Java 8 åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœé“¾è¡¨çš„é•¿åº¦è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰ï¼ŒHashMap ä¼šå°†é“¾è¡¨è½¬åŒ–ä¸º ")),e(t,{to:"/algorithm/0_base_4_tree#çº¢é»‘æ ‘-balanced-binary-search-tree-bbst"},{default:p(()=>n[10]||(n[10]=[a("çº¢é»‘æ ‘")])),_:1}),n[12]||(n[12]=a("ï¼Œ ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚"))])])]),n[32]||(n[32]=l('<p><img src="'+r+'" alt="img.png"></p><h3 id="_3ã€æ‰©å®¹æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_3ã€æ‰©å®¹æœºåˆ¶"><span>3ã€æ‰©å®¹æœºåˆ¶</span></a></h3><p>å½“ HashMap ä¸­çš„å…ƒç´ è¿‡å¤šæ—¶ï¼Œå“ˆå¸Œè¡¨çš„è´Ÿè½½å› å­ï¼ˆload factorï¼‰å¯èƒ½ä¼šè¾¾åˆ°é˜ˆå€¼ï¼Œå¯¼è‡´å“ˆå¸Œè¡¨çš„å­˜å‚¨æ•ˆç‡é™ä½ã€‚</p><ul><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè´Ÿè½½å› å­ä¸º 0.75ã€‚<strong>å½“å…ƒç´ ä¸ªæ•°è¶…è¿‡ (å½“å‰å®¹é‡ * è´Ÿè½½å› å­) æ—¶ï¼ŒHashMap ä¼šè¿›è¡Œæ‰©å®¹ï¼ˆé€šå¸¸æ˜¯åŸæ•°ç»„å¤§å°çš„ 2 å€ï¼‰</strong>ã€‚</p></li><li><p>æ‰©å®¹è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰å…ƒç´ çš„å“ˆå¸Œå€¼ä¼šè¢«é‡æ–°è®¡ç®—ï¼Œå¹¶é‡æ–°æ”¾ç½®åˆ°æ–°çš„æ•°ç»„ä½ç½®ã€‚å› ä¸º<strong>å“ˆå¸Œè¡¨çš„å¤§å°å‘ç”Ÿå˜åŒ–ï¼Œå¯¼è‡´åŸå…ˆçš„ç´¢å¼•ä½ç½®ä¸å†é€‚ç”¨</strong>ã€‚</p></li></ul><h3 id="_4ã€æ—¶é—´å¤æ‚åº¦" tabindex="-1"><a class="header-anchor" href="#_4ã€æ—¶é—´å¤æ‚åº¦"><span>4ã€æ—¶é—´å¤æ‚åº¦</span></a></h3><ul><li><strong>æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤ æ—¶é—´å¤æ‚åº¦</strong>ï¼š</li></ul><p>åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œå“ˆå¸Œè¡¨çš„æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</p>',7)),s("p",null,[n[14]||(n[14]=a("ä½†æ˜¯ï¼Œå¦‚æœå‘ç”Ÿå“ˆå¸Œå†²çªï¼Œæ€§èƒ½ä¼šé€€åŒ–åˆ° O(n)ï¼ˆé“¾è¡¨é•¿åº¦ä¸º n æ—¶ï¼‰ã€‚ ä½¿ç”¨ ")),e(t,{to:"/algorithm/0_base_4_tree#çº¢é»‘æ ‘-balanced-binary-search-tree-bbst"},{default:p(()=>n[13]||(n[13]=[a("çº¢é»‘æ ‘")])),_:1}),n[15]||(n[15]=a("ä¼˜åŒ–åï¼Œæœ€åæƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦ä¸º O(log n)ã€‚"))]),n[33]||(n[33]=l(`<ul><li><strong>æ‰©å®¹æ“ä½œçš„æ—¶é—´å¤æ‚åº¦</strong>ï¼š</li></ul><p>æ‰©å®¹æ˜¯ä¸€ä¸ªç›¸å¯¹è€—æ—¶çš„æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œä½†æ‰©å®¹æ“ä½œæ˜¯æŒ‰éœ€è¿›è¡Œçš„ï¼Œä¸æ˜¯é¢‘ç¹å‘ç”Ÿï¼Œå› æ­¤å¹³å‡è€Œè¨€ï¼ŒHashMap çš„æ“ä½œä»ç„¶æ˜¯ O(1)ã€‚</p><h2 id="äºŒã€linkedhashmapåˆ†æ" tabindex="-1"><a class="header-anchor" href="#äºŒã€linkedhashmapåˆ†æ"><span>äºŒã€LinkedHashMapåˆ†æ</span></a></h2><h3 id="_1ã€æœ‰åºæ€§æ”¯æŒ" tabindex="-1"><a class="header-anchor" href="#_1ã€æœ‰åºæ€§æ”¯æŒ"><span>1ã€æœ‰åºæ€§æ”¯æŒ</span></a></h3><p>ä¸ <code>HashMap</code> ä¸åŒï¼Œ<code>LinkedHashMap</code> ä¿ç•™äº†å…ƒç´ çš„é¡ºåºç‰¹æ€§ï¼š</p><ul><li>é»˜è®¤æŒ‰ç…§ <strong>æ’å…¥é¡ºåº</strong> æ’åˆ—ã€‚</li><li>å¯ä»¥é€‰æ‹©æŒ‰ç…§ <strong>è®¿é—®é¡ºåº</strong> æ’åˆ—ï¼ˆæ„é€ å‡½æ•°ä¸­è®¾ç½® <code>accessOrder=true</code>ï¼‰ã€‚</li></ul><h3 id="_2ã€éå†é¡ºåºå¯æ§" tabindex="-1"><a class="header-anchor" href="#_2ã€éå†é¡ºåºå¯æ§"><span>2ã€éå†é¡ºåºå¯æ§</span></a></h3><p>ä½¿ç”¨ <code>Iterator</code> éå†æ—¶ï¼Œå…ƒç´ çš„é¡ºåºï¼š</p><ul><li>æ’å…¥é¡ºåºæ¨¡å¼ä¸‹ï¼šä¸æ’å…¥é¡ºåºä¸€è‡´ï¼›</li><li>è®¿é—®é¡ºåºæ¨¡å¼ä¸‹ï¼šæœ€è¿‘è¢«è®¿é—®çš„å…ƒç´ ä¼šæ’åœ¨åé¢ã€‚</li></ul><h3 id="_3ã€åº”ç”¨åœºæ™¯-lru-ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_3ã€åº”ç”¨åœºæ™¯-lru-ç¼“å­˜"><span>3ã€åº”ç”¨åœºæ™¯ï¼šLRU ç¼“å­˜</span></a></h3><p>é€šè¿‡è®¾ç½®ä¸ºè®¿é—®é¡ºåº + æ­é… <code>removeEldestEntry</code> æ–¹æ³•ï¼Œ<code>LinkedHashMap</code> å¯è½»æ¾å®ç°ï¼š</p><ul><li><strong>æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰ç¼“å­˜æ·˜æ±°ç­–ç•¥</strong></li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">0.75f</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// accessOrder = true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_4ã€ç±»å…³ç³»å›¾" tabindex="-1"><a class="header-anchor" href="#_4ã€ç±»å…³ç³»å›¾"><span>4ã€ç±»å…³ç³»å›¾</span></a></h3><p><img src="`+d+`" alt=""></p><h2 id="ä¸‰ã€concurrenthashmapåˆ†æ" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€concurrenthashmapåˆ†æ"><span>ä¸‰ã€ConcurrentHashMapåˆ†æ</span></a></h2><h3 id="_1ã€åŸºæœ¬ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#_1ã€åŸºæœ¬ç‰¹æ€§"><span>1ã€åŸºæœ¬ç‰¹æ€§</span></a></h3><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td><strong>çº¿ç¨‹å®‰å…¨</strong></td><td>é‡‡ç”¨ CAS + è‡ªæ—‹é” æ›¿ä»£ synchronizedï¼Œå‡å°‘é”ç«äº‰</td></tr><tr><td><strong>é«˜å¹¶å‘</strong></td><td>è¯»æ“ä½œæ— é”ï¼Œå†™æ“ä½œå±€éƒ¨åŠ é”ï¼Œé¿å…å…¨å±€é”çš„æ€§èƒ½ç“¶é¢ˆ</td></tr><tr><td><strong>ä¸æ”¯æŒ null</strong></td><td>key å’Œ value éƒ½ ä¸èƒ½ä¸º nullï¼Œé˜²æ­¢ NullPointerException</td></tr><tr><td><strong>æ¯” Hashtable æ€§èƒ½é«˜</strong></td><td>Hashtable ä½¿ç”¨ synchronized è¿›è¡Œå…¨è¡¨åŠ é”ï¼Œè€Œ ConcurrentHashMap é‡‡ç”¨ åˆ†æ®µé”æœºåˆ¶ï¼ˆJDK 1.7ï¼‰å’Œ CAS + è‡ªæ—‹é”ï¼ˆJDK 1.8ï¼‰</td></tr></tbody></table><h3 id="_2ã€jdk-1-7-å’Œ-1-8-å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#_2ã€jdk-1-7-å’Œ-1-8-å¯¹æ¯”"><span>2ã€JDK 1.7 å’Œ 1.8 å¯¹æ¯”</span></a></h3><table><thead><tr><th><strong>ç‰ˆæœ¬</strong></th><th><strong>JDK 1.7</strong></th><th><strong>JDK 1.8 åŠä»¥å</strong></th></tr></thead><tbody><tr><td><strong>åº•å±‚æ•°æ®ç»“æ„</strong></td><td>Segmentï¼ˆåˆ†æ®µé”ï¼‰ + æ•°ç»„ + é“¾è¡¨</td><td>æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ï¼ˆå¤§äº 8 ä¸ªå…ƒç´ ï¼‰</td></tr><tr><td><strong>åŠ é”æ–¹å¼</strong></td><td>åˆ†æ®µé”ï¼ˆSegment ç»§æ‰¿ ReentrantLockï¼‰</td><td>CAS + è‡ªæ—‹é” + synchronizedï¼ˆå±€éƒ¨ï¼‰</td></tr><tr><td><strong>å¹¶å‘æ§åˆ¶</strong></td><td>å¤šä¸ª Segment äº’ä¸å½±å“</td><td>CAS æ–¹å¼ä¼˜åŒ–ï¼Œå‡å°‘é”ç«äº‰</td></tr><tr><td><strong>å†™å…¥æ€§èƒ½</strong></td><td>åˆ†æ®µé”ï¼Œæ€§èƒ½è¾ƒå¥½</td><td>CAS + å±€éƒ¨é”ï¼Œæ€§èƒ½æ›´é«˜</td></tr><tr><td><strong>æ‰©å®¹æœºåˆ¶</strong></td><td>Segment çº§åˆ«æ‰©å®¹</td><td>æ— é”æ‰©å®¹ï¼Œæ”¯æŒå¹¶å‘æ‰©å®¹</td></tr></tbody></table><div class="hint-container warning"><p class="hint-container-title">Todo</p><p>æ›´åŠ ç²¾é€šåå®Œæˆã€‚ã€‚ã€‚</p></div><h2 id="å››ã€concurrenthashmap-ä¸ºä½•æ”¾å¼ƒåˆ†æ®µé”" tabindex="-1"><a class="header-anchor" href="#å››ã€concurrenthashmap-ä¸ºä½•æ”¾å¼ƒåˆ†æ®µé”"><span>å››ã€ConcurrentHashMap ä¸ºä½•æ”¾å¼ƒåˆ†æ®µé”ï¼Ÿ</span></a></h2><h3 id="_1ã€jdk-1-7-å‰åˆ†æ®µé”å¼Šç«¯" tabindex="-1"><a class="header-anchor" href="#_1ã€jdk-1-7-å‰åˆ†æ®µé”å¼Šç«¯"><span>1ã€JDK 1.7 å‰åˆ†æ®µé”å¼Šç«¯</span></a></h3><p>åœ¨ JDK 1.7 ä¹‹å‰ï¼Œ<code>ConcurrentHashMap</code> ä½¿ç”¨ <strong>åˆ†æ®µé”ï¼ˆSegmentï¼‰</strong>ï¼Œæ¯ä¸ª <code>Segment</code> ç®¡ç†ç‹¬ç«‹çš„ <code>HashEntry[]</code>ã€‚ä½†å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li><p><strong>æ‰©å®¹æ€§èƒ½å·®</strong>ï¼šæ‰©å®¹æ—¶éœ€è¦å¯¹æ•´ä¸ª <code>Segment</code> åŠ é”ï¼Œå½±å“å¹¶å‘ã€‚</p></li><li><p><strong>å†…å­˜æµªè´¹</strong>ï¼šé¢„å…ˆåˆ†é…å¤šä¸ª <code>Segment</code>ï¼Œå³ä½¿ä¸ä½¿ç”¨ä¹Ÿå ç”¨å†…å­˜ã€‚</p></li><li><p><strong>ä»£ç å¤æ‚</strong>ï¼šé”ç®¡ç†å¤æ‚ï¼Œä¸” <code>put()</code> éœ€è¦ä¸¤æ¬¡ <code>hash</code> è®¡ç®—ï¼Œé™ä½æ€§èƒ½ã€‚</p></li></ul><h3 id="_2ã€jdk-1-8-åçš„æ–°æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_2ã€jdk-1-8-åçš„æ–°æ–¹æ¡ˆ"><span>2ã€JDK 1.8 åçš„æ–°æ–¹æ¡ˆ</span></a></h3><p>JDK 1.8 æ”¾å¼ƒäº† <code>Segment</code>ï¼Œæ”¹ç”¨ <strong>æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘</strong> ç»“æ„ï¼Œç»“åˆ <strong>CAS</strong> å’Œ <strong>synchronized</strong> å±€éƒ¨åŠ é”ï¼Œæå‡å¹¶å‘æ€§èƒ½ã€‚</p><ul><li><strong>CAS æ— é”ä¼˜åŒ–</strong>ï¼šé¿å…é”ç«äº‰ï¼Œæé«˜ååé‡ã€‚</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// æ‰°åŠ¨å“ˆå¸Œï¼Œå‡å°‘ç¢°æ’</span></span>
<span class="line">    <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">spread</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// è®¡ç®—æ¡¶ç´¢å¼•</span></span>
<span class="line">    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token punctuation">(</span>table<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// å¦‚æœæ¡¶æ˜¯ç©ºçš„ï¼Œç›´æ¥ CAS æ’å…¥ï¼ˆæ— é”ï¼‰</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">tabAt</span><span class="token punctuation">(</span>table<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">casTabAt</span><span class="token punctuation">(</span>table<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// å¦åˆ™è¿›å…¥åŠ é”æµç¨‹</span></span>
<span class="line">    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>table<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// é“¾è¡¨æ’å…¥æˆ–æ ‘å½¢æ’å…¥é€»è¾‘...</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>synchronized å±€éƒ¨åŠ é”</strong>ï¼šåªé”å®šå½“å‰æ¡¶ä½ï¼Œå‡å°‘é”ç«äº‰ã€‚</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> f <span class="token operator">=</span> <span class="token function">tabAt</span><span class="token punctuation">(</span>table<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">casTabAt</span><span class="token punctuation">(</span>table<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å±€éƒ¨åŠ é”ï¼Œåªé”å®šå½“å‰æ¡¶ä½</span></span>
<span class="line">            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e <span class="token operator">=</span> f<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">while</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>key<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token comment">// è¦†ç›–å·²æœ‰ key çš„å€¼</span></span>
<span class="line">                    <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token comment">// æ’å…¥æ–°èŠ‚ç‚¹</span></span>
<span class="line">            f<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>çº¢é»‘æ ‘ä¼˜åŒ–</strong>ï¼šå½“é“¾è¡¨é•¿åº¦è¶…è¿‡ 8ï¼Œè½¬ä¸ºçº¢é»‘æ ‘ï¼ŒæŸ¥è¯¢æ•ˆç‡æé«˜ã€‚</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> f <span class="token operator">=</span> <span class="token function">tabAt</span><span class="token punctuation">(</span>table<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e <span class="token operator">=</span> f<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>next <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            binCount<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">            e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">&gt;=</span> <span class="token constant">TREEIFY_THRESHOLD</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// é»˜è®¤å€¼ä¸º8</span></span>
<span class="line">            <span class="token function">treeifyBin</span><span class="token punctuation">(</span>table<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è½¬ä¸ºçº¢é»‘æ ‘ç»“æ„</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>æ— é”æ‰©å®¹</strong>ï¼šå¤šä¸ªçº¿ç¨‹å¹¶è¡Œè¿ç§»æ•°æ®ï¼Œæå‡æ‰©å®¹æ•ˆç‡ã€‚</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> oldTab <span class="token operator">=</span> table<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">int</span> oldCap <span class="token operator">=</span> oldTab<span class="token punctuation">.</span>length<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">int</span> newCap <span class="token operator">=</span> oldCap <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTab <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">[</span>newCap<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> oldCap<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e <span class="token operator">=</span> oldTab<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">transferNode</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> newTab<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†é“¾è¡¨æˆ–æ ‘è¿ç§»åˆ°æ–°è¡¨</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    table <span class="token operator">=</span> newTab<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3ã€ä¸¤å¥è¯æ€»ç»“å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#_3ã€ä¸¤å¥è¯æ€»ç»“å¯¹æ¯”"><span>3ã€ä¸¤å¥è¯æ€»ç»“å¯¹æ¯”</span></a></h3><ul><li><p>JDK 1.7 åˆ†æ®µé”çš„æ€§èƒ½å·®ã€ç©ºé—´æµªè´¹å’Œå¤æ‚æ€§é—®é¢˜ã€‚</p></li><li><p>JDK 1.8 æ”¹ç”¨ CASã€synchronized å’Œçº¢é»‘æ ‘ï¼Œæå‡äº†å¹¶å‘æ€§èƒ½å’ŒæŸ¥è¯¢æ•ˆç‡ï¼Œæ”¯æŒæ— é”æ‰©å®¹ã€‚</p></li></ul><blockquote><p><strong>æç¤º</strong>ï¼šJDK 1.8 çš„ <code>ConcurrentHashMap</code> åœ¨é«˜å¹¶å‘ä¸‹è¡¨ç°æ›´ä¼˜ï¼Œé¿å…äº†åˆ†æ®µé”å¸¦æ¥çš„æ€§èƒ½ç“¶é¢ˆã€‚</p></blockquote><h2 id="å››ã€hashmapã€linkedhashmapã€concurrenthashmapå¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#å››ã€hashmapã€linkedhashmapã€concurrenthashmapå¯¹æ¯”"><span>å››ã€HashMapã€LinkedHashMapã€ConcurrentHashMapå¯¹æ¯”</span></a></h2><table><thead><tr><th><strong>å¯¹æ¯”é¡¹</strong></th><th><strong>HashMap</strong></th><th><strong>LinkedHashMap</strong></th><th><strong>ConcurrentHashMap</strong></th></tr></thead><tbody><tr><td><strong>åº•å±‚æ•°æ®ç»“æ„</strong></td><td>å“ˆå¸Œè¡¨ï¼ˆæ•°ç»„ + é“¾è¡¨/çº¢é»‘æ ‘ï¼‰</td><td>å“ˆå¸Œè¡¨ + åŒå‘é“¾è¡¨</td><td>å“ˆå¸Œè¡¨ï¼ˆåˆ†æ®µé”ã€CAS æœºåˆ¶ï¼‰</td></tr><tr><td><strong>key æ˜¯å¦æœ‰åº</strong></td><td>âŒ æ— åº</td><td>âœ… æŒ‰æ’å…¥é¡ºåºæ’åº</td><td>âŒ æ— åº</td></tr><tr><td><strong>æ—¶é—´å¤æ‚åº¦</strong></td><td>O(1) å¹³å‡ï¼ŒO(n) æœ€å</td><td>O(1) å¹³å‡ï¼ŒO(n) æœ€å</td><td>O(1) å¹³å‡ï¼ŒO(n) æœ€å</td></tr><tr><td><strong>æ˜¯å¦å…è®¸ null key</strong></td><td>âœ… å…è®¸</td><td>âœ… å…è®¸</td><td>âŒ ä¸å…è®¸</td></tr><tr><td><strong>æ˜¯å¦å…è®¸ null value</strong></td><td>âœ… å…è®¸</td><td>âœ… å…è®¸</td><td>âŒ ä¸å…è®¸</td></tr><tr><td><strong>çº¿ç¨‹å®‰å…¨</strong></td><td>âŒ éçº¿ç¨‹å®‰å…¨</td><td>âŒ éçº¿ç¨‹å®‰å…¨</td><td>âœ… çº¿ç¨‹å®‰å…¨</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>å¿«é€ŸæŸ¥æ‰¾ã€æ— åºå­˜å‚¨ã€å¤§é‡æ•°æ®</td><td>éœ€è¦æŒ‰æ’å…¥é¡ºåºéå†çš„åœºæ™¯</td><td>å¹¶å‘ç¯å¢ƒä¸‹çš„é«˜æ•ˆå“ˆå¸Œæ˜ å°„</td></tr><tr><td><strong>ä¸»è¦åº”ç”¨</strong></td><td>ç¼“å­˜ã€æ˜ å°„æŸ¥æ‰¾ã€å¯¹è±¡å­˜å‚¨</td><td>LRU ç¼“å­˜ã€è®¿é—®é¡ºåºå­˜å‚¨</td><td>é«˜å¹¶å‘åœºæ™¯ï¼Œå¦‚ç¼“å­˜ã€çº¿ç¨‹æ± </td></tr></tbody></table><h2 id="ä¸‰ã€treemapåˆ†æ" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€treemapåˆ†æ"><span>ä¸‰ã€TreeMapåˆ†æ</span></a></h2><h3 id="_1ã€æºç åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_1ã€æºç åˆ†æ"><span>1ã€æºç åˆ†æ</span></a></h3><ul><li>ç±»å…³è”å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</li></ul><p><img src="`+k+'" alt="image.png"></p><ul><li>TreeMap çš„æ ¸å¿ƒç‰¹ç‚¹</li></ul>',45)),s("table",null,[n[24]||(n[24]=s("thead",null,[s("tr",null,[s("th",null,"ç‰¹æ€§"),s("th",null,"è¯´æ˜")])],-1)),s("tbody",null,[s("tr",null,[n[18]||(n[18]=s("td",null,"åº•å±‚å®ç°",-1)),s("td",null,[e(t,{to:"/algorithm/0_base_4_tree#çº¢é»‘æ ‘-balanced-binary-search-tree-bbst"},{default:p(()=>n[16]||(n[16]=[a("çº¢é»‘æ ‘")])),_:1}),n[17]||(n[17]=a("ï¼ˆRed-Black Treeï¼‰ï¼Œæ˜¯ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰"))])]),n[19]||(n[19]=s("tr",null,[s("td",null,"æ’åºæ–¹å¼"),s("td",null,"é»˜è®¤æŒ‰ key çš„ è‡ªç„¶é¡ºåºï¼ˆComparableï¼‰ æ’åºï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ è‡ªå®šä¹‰ Comparator")],-1)),n[20]||(n[20]=s("tr",null,[s("td",null,"æ—¶é—´å¤æ‚åº¦"),s("td",null,"O(log n)ï¼ˆå¢ã€åˆ ã€æŸ¥ï¼‰")],-1)),n[21]||(n[21]=s("tr",null,[s("td",null,"æ˜¯å¦å…è®¸ null key"),s("td",null,"âŒ ä¸å…è®¸ null keyï¼ˆä¼šæŠ› NullPointerExceptionï¼‰")],-1)),n[22]||(n[22]=s("tr",null,[s("td",null,"æ˜¯å¦å…è®¸ null value"),s("td",null,"âœ… å…è®¸ null value")],-1)),n[23]||(n[23]=s("tr",null,[s("td",null,"æ˜¯å¦çº¿ç¨‹å®‰å…¨"),s("td",null,"âŒ éçº¿ç¨‹å®‰å…¨ï¼ˆéœ€è¦ Collections.synchronizedMap() ä¿æŠ¤ï¼‰")],-1))])]),n[34]||(n[34]=l(`<div class="hint-container important"><p class="hint-container-title">ä½¿ç”¨é€”å¾„</p><p>é€‚ç”¨äºéœ€è¦ &quot;<strong>è‡ªåŠ¨æ’åº</strong>&quot; å’Œ &quot;<strong>èŒƒå›´æŸ¥è¯¢</strong>&quot; çš„åœºæ™¯ã€‚</p></div><p>1ã€é€‚ç”¨åœºæ™¯ï¼šæ•°æ®å­˜å‚¨æ—¶è¦æ±‚æŒ‰ç…§ key è¿›è¡Œæ’åºï¼Œæ–¹ä¾¿åç»­æŸ¥è¯¢å’Œå±•ç¤º</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> productMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    productMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token string">&quot;iPhone&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    productMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token string">&quot;Samsung&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    productMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token string">&quot;Huawei&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// éå†æ—¶ key æ˜¯æŒ‰é¡ºåºæ’åºçš„ï¼ˆ101, 102, 103ï¼‰</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> productMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; -&gt; &quot;</span> <span class="token operator">+</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€éœ€è¦ &quot;èŒƒå›´æŸ¥è¯¢&quot; æˆ– &quot;åŒºé—´æœç´¢&quot;</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> transactionMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    transactionMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1707052800000L</span><span class="token punctuation">,</span> <span class="token string">&quot;è®¢å• A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2024-02-05 00:00:00</span></span>
<span class="line">    transactionMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1707139200000L</span><span class="token punctuation">,</span> <span class="token string">&quot;è®¢å• B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2024-02-06 00:00:00</span></span>
<span class="line">    transactionMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1707225600000L</span><span class="token punctuation">,</span> <span class="token string">&quot;è®¢å• C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2024-02-07 00:00:00</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// è·å– 2 æœˆ 5 æ—¥åˆ° 2 æœˆ 6 æ—¥ä¹‹é—´çš„äº¤æ˜“</span></span>
<span class="line">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> transactionMap<span class="token punctuation">.</span><span class="token function">subMap</span><span class="token punctuation">(</span><span class="token number">1707052800000L</span><span class="token punctuation">,</span> <span class="token number">1707139200000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2ã€ç›¸å…³ç±»å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#_2ã€ç›¸å…³ç±»å¯¹æ¯”"><span>2ã€ç›¸å…³ç±»å¯¹æ¯”</span></a></h3><table><thead><tr><th><strong>å¯¹æ¯”é¡¹</strong></th><th><strong>TreeMap</strong></th><th><strong>ConcurrentSkipListMap</strong></th></tr></thead><tbody><tr><td><strong>åº•å±‚æ•°æ®ç»“æ„</strong></td><td>çº¢é»‘æ ‘ï¼ˆRed-Black Treeï¼‰</td><td>è·³è¡¨ï¼ˆSkip Listï¼‰</td></tr><tr><td><strong>key æ˜¯å¦æœ‰åº</strong></td><td>âœ… æœ‰åºï¼ˆæŒ‰ key æ’åºï¼‰</td><td>âœ… æœ‰åºï¼ˆæŒ‰ key æ’åºï¼‰</td></tr><tr><td><strong>æ—¶é—´å¤æ‚åº¦</strong></td><td>O(log n)</td><td>O(log n)</td></tr><tr><td><strong>æ˜¯å¦å…è®¸ null key</strong></td><td>âŒ ä¸å…è®¸</td><td>âŒ ä¸å…è®¸</td></tr><tr><td><strong>æ˜¯å¦å…è®¸ null value</strong></td><td>âœ… å…è®¸</td><td>âœ… å…è®¸</td></tr><tr><td><strong>çº¿ç¨‹å®‰å…¨</strong></td><td>âŒ éçº¿ç¨‹å®‰å…¨</td><td>âœ… çº¿ç¨‹å®‰å…¨</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>éœ€è¦æ’åºã€èŒƒå›´æŸ¥è¯¢ã€å¯¼èˆªç»“æ„</td><td>å¹¶å‘ç¯å¢ƒä¸‹çš„æœ‰åºæ˜ å°„</td></tr><tr><td><strong>ä¸»è¦åº”ç”¨</strong></td><td>æ’åã€æ—¥å¿—å­˜å‚¨ã€åŒºé—´æŸ¥æ‰¾</td><td>çº¿ç¨‹å®‰å…¨çš„æ’åºæ˜ å°„ç»“æ„</td></tr></tbody></table><h2 id="å››ã€hashmapå’Œhashtableå¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#å››ã€hashmapå’Œhashtableå¯¹æ¯”"><span>å››ã€HashMapå’ŒHashTableå¯¹æ¯”</span></a></h2><h3 id="_1ã€ç»å…¸å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#_1ã€ç»å…¸å¯¹æ¯”"><span>1ã€ç»å…¸å¯¹æ¯”</span></a></h3><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>HashMap</th><th>Hashtable</th></tr></thead><tbody><tr><td><strong>çº¿ç¨‹å®‰å…¨</strong></td><td>âŒ éçº¿ç¨‹å®‰å…¨</td><td>âœ… çº¿ç¨‹å®‰å…¨ï¼ˆæ–¹æ³•åŠ é” synchronizedï¼‰</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>ğŸš€ æ€§èƒ½æ›´é«˜ï¼ˆæ— é”ï¼‰</td><td>ğŸŒ æ€§èƒ½è¾ƒä½ï¼ˆåŠ é”å¯¼è‡´å¼€é”€å¤§ï¼‰</td></tr><tr><td><strong>æ˜¯å¦å…è®¸ null</strong></td><td>âœ… null key/value å…è®¸</td><td>âŒ null key/value ä¸å…è®¸</td></tr><tr><td><strong>æ•°æ®ç»“æ„</strong></td><td>JDK 1.8+: æ•°ç»„ + é“¾è¡¨/çº¢é»‘æ ‘</td><td>æ•°ç»„ + é“¾è¡¨</td></tr><tr><td><strong>é»˜è®¤åˆå§‹å®¹é‡</strong></td><td>16</td><td>11</td></tr><tr><td><strong>æ‰©å®¹æ–¹å¼</strong></td><td>å®¹é‡ç¿»å€ï¼ˆ2^n ç»“æ„ä¼˜åŒ–ï¼‰</td><td>å®¹é‡ç¿»å€ + 1</td></tr><tr><td><strong>éå†æ–¹å¼</strong></td><td>è¿­ä»£å™¨ Iteratorï¼ˆfail-fast æœºåˆ¶ï¼‰</td><td>Enumerationï¼ˆæ—§ç‰ˆæ–¹å¼ï¼‰</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>é€‚ç”¨äº å•çº¿ç¨‹ã€é«˜æ€§èƒ½åœºæ™¯</td><td>é€‚ç”¨äº å†å²é—ç•™ä»£ç ã€å¹¶å‘åœºæ™¯ï¼ˆå·²è¢«æ·˜æ±°ï¼‰</td></tr></tbody></table><h3 id="_2ã€æ¨è-concurrenthashmap" tabindex="-1"><a class="header-anchor" href="#_2ã€æ¨è-concurrenthashmap"><span>2ã€æ¨è ConcurrentHashMap</span></a></h3><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>âœ… ç”¨ HashMap</p><ul><li>å¤§å¤šæ•°åœºæ™¯ æ¨èä½¿ç”¨ HashMapï¼Œåªåœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ã€‚</li></ul><p>âœ… ç”¨ ConcurrentHashMapï¼ˆä»£æ›¿ Hashtableï¼‰</p><ul><li><p>å¦‚æœéœ€è¦çº¿ç¨‹å®‰å…¨ï¼Œ<strong>è¯·ç”¨ ConcurrentHashMapï¼Œä¸è¦ç”¨ Hashtableï¼</strong></p></li><li><p>ConcurrentHashMap åœ¨ <strong>é«˜å¹¶å‘ åœºæ™¯ä¸‹æ¯” Hashtable æ€§èƒ½æ›´ä¼˜ï¼ˆå±€éƒ¨åŠ é”ï¼Œç”šè‡³æ— é”ï¼‰</strong>ã€‚</p></li></ul></div><h2 id="äº”ã€çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼" tabindex="-1"><a class="header-anchor" href="#äº”ã€çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼"><span>äº”ã€çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼</span></a></h2><h3 id="_1ã€ç»§æ‰¿-thread-ç±»" tabindex="-1"><a class="header-anchor" href="#_1ã€ç»§æ‰¿-thread-ç±»"><span>1ã€ç»§æ‰¿ Thread ç±»</span></a></h3><p>è¿™ç§æ–¹æ³•éœ€è¦åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„çº¿ç¨‹ç±»ï¼Œç»§æ‰¿ Thread ç±»ï¼Œå¹¶é‡å†™ run() æ–¹æ³•ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: Hello from thread!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">MyThread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// å¯åŠ¨çº¿ç¨‹</span></span>
<span class="line">        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>ä¼˜ç‚¹ï¼šç®€å•ç›´è§‚ï¼Œé€‚åˆåªæœ‰ä¸€ä¸ªä»»åŠ¡çš„æƒ…å†µã€‚</p></li><li><p>ç¼ºç‚¹ï¼šå¦‚æœéœ€è¦ç»§æ‰¿å…¶ä»–ç±»ï¼Œæ— æ³•å†ç»§æ‰¿ Thread ç±»ï¼ˆJava æ˜¯å•ç»§æ‰¿ï¼‰ã€‚</p></li></ul><h3 id="_2ã€å®ç°-runnable-æ¥å£" tabindex="-1"><a class="header-anchor" href="#_2ã€å®ç°-runnable-æ¥å£"><span>2ã€å®ç° Runnable æ¥å£</span></a></h3><p>è¿™ç§æ–¹æ³•æ›´çµæ´»ï¼Œåˆ›å»ºä¸€ä¸ªå®ç° Runnable æ¥å£çš„ç±»ï¼Œå¹¶å°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™ Thread æ„é€ å‡½æ•°ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">MyRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: Hello from Runnable!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">MyRunnable</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å°†ä»»åŠ¡ä¼ é€’ç»™çº¿ç¨‹</span></span>
<span class="line">        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å¯åŠ¨çº¿ç¨‹</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>ä¼˜ç‚¹ï¼šå…è®¸å®ç°å¤šä¸ªæ¥å£ï¼Œæä¾›æ›´å¤šçš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p></li><li><p>ç¼ºç‚¹ï¼šæ¯”ç»§æ‰¿ Thread ç±»ç¨å¾®å¤æ‚ä¸€äº›ï¼Œä½†é€šå¸¸æ›´åŠ æ¨èã€‚</p></li></ul><h3 id="_3ã€å®ç°-callable-æ¥å£-å¸¦è¿”å›å€¼çš„ä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#_3ã€å®ç°-callable-æ¥å£-å¸¦è¿”å›å€¼çš„ä»»åŠ¡"><span>3ã€å®ç° Callable æ¥å£ï¼ˆå¸¦è¿”å›å€¼çš„ä»»åŠ¡ï¼‰</span></a></h3><p><code>Callable</code> æ˜¯ Java 5 å¼•å…¥çš„åŠŸèƒ½æ€§æ¥å£ï¼Œä¸ <code>Runnable</code> ç±»ä¼¼ï¼Œç”¨äºå®šä¹‰çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡é€»è¾‘ã€‚ä½†å®ƒæ”¯æŒï¼š</p><ul><li>è¿”å›ç»“æœï¼›</li><li>æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Callable</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyCallable</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string">&quot;Hello from Callable&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä¸ <code>Runnable</code> ä¸åŒï¼Œ<code>Callable</code> çš„ <code>call()</code> æ–¹æ³•æœ‰è¿”å›å€¼ï¼Œå¹¶ä¸”å¯ä»¥æŠ›å‡ºå—æ£€å¼‚å¸¸ã€‚</li><li>é€šå¸¸ä¸ <code>Future</code>ã€<code>ExecutorService</code> æ­é…ä½¿ç”¨ã€‚</li></ul><hr><h3 id="_4ã€future-æ¥å£-ä»»åŠ¡ç»“æœçš„è·å–ä¸æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#_4ã€future-æ¥å£-ä»»åŠ¡ç»“æœçš„è·å–ä¸æ§åˆ¶"><span>4ã€Future æ¥å£ï¼ˆä»»åŠ¡ç»“æœçš„è·å–ä¸æ§åˆ¶ï¼‰</span></a></h3><p><code>Future</code> ç”¨äºè¡¨ç¤º<strong>ä¸€ä¸ªå¼‚æ­¥è®¡ç®—çš„ç»“æœ</strong>ã€‚é€šè¿‡å®ƒå¯ä»¥ï¼š</p><ul><li>è·å– <code>Callable</code> ä»»åŠ¡çš„è¿”å›ç»“æœï¼›</li><li>æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å®Œæˆï¼›</li><li>å–æ¶ˆä»»åŠ¡ï¼›</li><li>é˜»å¡ç­‰å¾…ä»»åŠ¡å®Œæˆã€‚</li></ul><h4 id="ç¤ºä¾‹-ç»“åˆ-callable-å’Œ-future-ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-ç»“åˆ-callable-å’Œ-future-ä½¿ç”¨"><span>ç¤ºä¾‹ï¼šç»“åˆ Callable å’Œ Future ä½¿ç”¨</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FutureDemo</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> task <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token string">&quot;Callable task completed&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æäº¤ Callable ä»»åŠ¡</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// å¯ä»¥åšå…¶ä»–äº‹æƒ…</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Main thread doing other things...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// è·å–ç»“æœï¼ˆä¼šé˜»å¡ç›´åˆ°ä»»åŠ¡å®Œæˆï¼‰</span></span>
<span class="line">        <span class="token class-name">String</span> result <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Task result: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        executor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="future-å¸¸ç”¨æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#future-å¸¸ç”¨æ–¹æ³•"><span>Future å¸¸ç”¨æ–¹æ³•</span></a></h4><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>get()</code></td><td>é˜»å¡ç­‰å¾…ä»»åŠ¡å®Œæˆå¹¶è¿”å›ç»“æœã€‚</td></tr><tr><td><code>get(timeout, unit)</code></td><td>åœ¨æŒ‡å®šæ—¶é—´å†…ç­‰å¾…ä»»åŠ¡å®Œæˆï¼Œè¶…æ—¶æŠ›å‡º <code>TimeoutException</code>ã€‚</td></tr><tr><td><code>isDone()</code></td><td>åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²å®Œæˆã€‚</td></tr><tr><td><code>cancel(true)</code></td><td>å°è¯•å–æ¶ˆä»»åŠ¡ï¼ˆå¦‚è®¾ç½®ä¸º trueï¼Œå¯ä¸­æ–­æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼‰ã€‚</td></tr><tr><td><code>isCancelled()</code></td><td>åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²è¢«å–æ¶ˆã€‚</td></tr></tbody></table><h3 id="_5ã€å…¶ä»–é«˜çº§æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_5ã€å…¶ä»–é«˜çº§æ–¹å¼"><span>5ã€å…¶ä»–é«˜çº§æ–¹å¼</span></a></h3>`,35)),s("ul",null,[s("li",null,[e(t,{to:"/java/2_advanced.html#ä¸‰ã€å¤šçº¿ç¨‹ä¸å¹¶å‘ç¼–ç¨‹"},{default:p(()=>n[25]||(n[25]=[a("å¤šçº¿ç¨‹ä¸å¹¶å‘ç¼–ç¨‹")])),_:1})])]),n[35]||(n[35]=l('<h2 id="å…­ã€volatile-å…³é”®å­—" tabindex="-1"><a class="header-anchor" href="#å…­ã€volatile-å…³é”®å­—"><span>å…­ã€volatile å…³é”®å­—</span></a></h2><h3 id="_1ã€çº¿ç¨‹å¯è§æ€§æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_1ã€çº¿ç¨‹å¯è§æ€§æœºåˆ¶"><span>1ã€çº¿ç¨‹å¯è§æ€§æœºåˆ¶</span></a></h3><h4 id="å†…å­˜æ¨¡å‹å›¾è§£" tabindex="-1"><a class="header-anchor" href="#å†…å­˜æ¨¡å‹å›¾è§£"><span><strong>å†…å­˜æ¨¡å‹å›¾è§£</strong></span></a></h4><p><img src="'+v+'" alt="volatile.png"></p><h4 id="æ ¸å¿ƒç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒç‰¹æ€§"><span><strong>æ ¸å¿ƒç‰¹æ€§</strong></span></a></h4><ul><li><p><strong>å³æ—¶åˆ·æ–°</strong>ï¼šå½“çº¿ç¨‹ä¿®æ”¹volatileå˜é‡æ—¶ï¼Œæ–°å€¼<strong>ç«‹å³å†™å›ä¸»å†…å­˜</strong></p></li><li><p><strong>è¯»å–ç©¿é€</strong>ï¼šå…¶ä»–çº¿ç¨‹è¯»å–æ—¶<strong>ç»•è¿‡å·¥ä½œå†…å­˜</strong>ï¼Œç›´æ¥è¯»å–ä¸»å†…å­˜æœ€æ–°å€¼</p></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šçŠ¶æ€æ ‡å¿—ä½ï¼ˆå¦‚<code>boolean running</code>ï¼‰ã€ä¸€æ¬¡æ€§å®‰å…¨å‘å¸ƒ</p></li></ul><blockquote><p>âš ï¸ æ³¨æ„ï¼š<code>count++</code>è¿™ç±»å¤åˆæ“ä½œä»éœ€é…åˆ<code>synchronized</code>æˆ–<code>AtomicXXX</code></p></blockquote><h3 id="_2ã€ç¦æ­¢æŒ‡ä»¤é‡æ’åŸç†" tabindex="-1"><a class="header-anchor" href="#_2ã€ç¦æ­¢æŒ‡ä»¤é‡æ’åŸç†"><span>2ã€ç¦æ­¢æŒ‡ä»¤é‡æ’åŸç†</span></a></h3><h4 id="å†…å­˜å±éšœç¤ºæ„å›¾" tabindex="-1"><a class="header-anchor" href="#å†…å­˜å±éšœç¤ºæ„å›¾"><span><strong>å†…å­˜å±éšœç¤ºæ„å›¾</strong></span></a></h4><p><img src="'+h+`" alt="command_reformat.png"></p><h4 id="happens-beforeè§„åˆ™" tabindex="-1"><a class="header-anchor" href="#happens-beforeè§„åˆ™"><span><strong>happens-beforeè§„åˆ™</strong></span></a></h4><ol><li><p><strong>å†™å±éšœ</strong>ï¼šç¡®ä¿volatileå†™ä¹‹å‰çš„æ“ä½œä¸ä¼šé‡æ’åˆ°å†™ä¹‹å</p></li><li><p><strong>è¯»å±éšœ</strong>ï¼šé˜²æ­¢volatileè¯»ä¹‹åçš„æ“ä½œé‡æ’åˆ°è¯»ä¹‹å‰</p></li><li><p><strong>ä¼ é€’æ€§</strong>ï¼šçº¿ç¨‹Aå†™volatileå˜é‡ â†’ çº¿ç¨‹Bè¯»è¯¥å˜é‡ â†’ çº¿ç¨‹Bèƒ½çœ‹åˆ°Açš„æ‰€æœ‰å†™æ“ä½œ</p></li></ol><h3 id="_3ã€åŒé‡æ£€æŸ¥é”æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#_3ã€åŒé‡æ£€æŸ¥é”æ¡ˆä¾‹"><span>3ã€åŒé‡æ£€æŸ¥é”æ¡ˆä¾‹</span></a></h3><h4 id="æ­£ç¡®å®ç°ä»£ç " tabindex="-1"><a class="header-anchor" href="#æ­£ç¡®å®ç°ä»£ç "><span>æ­£ç¡®å®ç°ä»£ç </span></a></h4><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// volatileä¿è¯ä»¥ä¸‹æ“ä½œä¸é‡æ’ï¼š</span></span>
<span class="line">                <span class="token comment">// 1. memory = allocate() åˆ†é…ç©ºé—´</span></span>
<span class="line">                <span class="token comment">// 2. init(memory) åˆå§‹åŒ–å¯¹è±¡ â† StoreStoreå±éšœåœ¨æ­¤</span></span>
<span class="line">                <span class="token comment">// 3. instance = memory è®¾ç½®å¼•ç”¨ â† StoreLoadå±éšœåœ¨æ­¤</span></span>
<span class="line">                instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> instance<span class="token punctuation">;</span> <span class="token comment">// LoadLoadå±éšœä¿è¯è¯»åˆ°æœ€æ–°å€¼</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å¯¹è±¡åˆ›å»ºè¿‡ç¨‹å›¾è§£" tabindex="-1"><a class="header-anchor" href="#å¯¹è±¡åˆ›å»ºè¿‡ç¨‹å›¾è§£"><span><strong>å¯¹è±¡åˆ›å»ºè¿‡ç¨‹å›¾è§£</strong></span></a></h4><p><img src="`+m+`" alt="singleton_double_check.png"></p><h4 id="å…³é”®ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#å…³é”®ä½œç”¨"><span><strong>å…³é”®ä½œç”¨</strong></span></a></h4><ul><li><p>é˜»æ­¢<code>instance = new Singleton()</code>è¢«é‡æ’ä¸ºã€Œå…ˆèµ‹å€¼ååˆå§‹åŒ–ã€</p></li><li><p>ä¿è¯å…¶ä»–çº¿ç¨‹æ‹¿åˆ°çš„æ˜¯<strong>å®Œå…¨åˆå§‹åŒ–çš„å¯¹è±¡</strong></p></li></ul><h3 id="_4ã€å¯¹æ¯”æ€»ç»“è¡¨" tabindex="-1"><a class="header-anchor" href="#_4ã€å¯¹æ¯”æ€»ç»“è¡¨"><span>4ã€å¯¹æ¯”æ€»ç»“è¡¨</span></a></h3><table><thead><tr><th>ç‰¹æ€§</th><th>volatile</th><th>synchronized</th><th>AtomicXXX</th></tr></thead><tbody><tr><td>å¯è§æ€§</td><td>âœ”</td><td>âœ”</td><td>âœ”</td></tr><tr><td>åŸå­æ€§</td><td>âœ–</td><td>âœ”</td><td>âœ”</td></tr><tr><td>ç¦æ­¢é‡æ’</td><td>âœ”</td><td>âœ”</td><td>âœ–</td></tr><tr><td>æ€§èƒ½æˆæœ¬</td><td>ä½</td><td>é«˜</td><td>ä¸­</td></tr></tbody></table><h2 id="ä¸ƒã€çº¿ç¨‹çš„ç­‰å¾…ä¸å”¤é†’æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€çº¿ç¨‹çš„ç­‰å¾…ä¸å”¤é†’æœºåˆ¶"><span>ä¸ƒã€çº¿ç¨‹çš„ç­‰å¾…ä¸å”¤é†’æœºåˆ¶</span></a></h2><p>åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œçº¿ç¨‹çš„ç­‰å¾…ä¸å”¤é†’æ˜¯å®ç°çº¿ç¨‹é—´åä½œã€èµ„æºåŒæ­¥çš„é‡è¦æ‰‹æ®µã€‚Java ä¸­æä¾›äº†å¤šç§æœºåˆ¶æ¥å®ç°çº¿ç¨‹çš„é˜»å¡ä¸å”¤é†’ï¼Œ åŒ…æ‹¬åŸºäº <code>Object</code>ã€<code>Thread</code>ã€<code>Lock</code> ä»¥åŠ <code>LockSupport</code> çš„æ–¹å¼ã€‚</p><h3 id="_1ã€objectçš„wait-notify-notifyall" tabindex="-1"><a class="header-anchor" href="#_1ã€objectçš„wait-notify-notifyall"><span>1ã€Objectçš„wait() / notify() / notifyAll()</span></a></h3><ul><li><p>å±äºåŸºç¡€çš„çº¿ç¨‹é€šä¿¡æ–¹å¼ï¼Œä½¿ç”¨çš„æ˜¯å¯¹è±¡ç›‘è§†å™¨ï¼ˆMonitorï¼‰ã€‚</p></li><li><p>åªèƒ½åœ¨ <code>synchronized</code> å—æˆ–æ–¹æ³•å†…éƒ¨è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ›å‡º <code>IllegalMonitorStateException</code>ã€‚</p></li><li><p>æ–¹æ³•è¯´æ˜ï¼š</p><ul><li><p><code>wait()</code>ï¼šå½“å‰çº¿ç¨‹ç­‰å¾…å¹¶é‡Šæ”¾é”ï¼Œè¿›å…¥å¯¹è±¡çš„ç­‰å¾…é˜Ÿåˆ—ã€‚</p></li><li><p><code>notify()</code>ï¼šå”¤é†’ä¸€ä¸ªæ­£åœ¨ç­‰å¾…è¯¥å¯¹è±¡é”çš„çº¿ç¨‹ï¼ˆå…·ä½“å“ªä¸ªç”± JVM å†³å®šï¼‰ã€‚</p></li><li><p><code>notifyAll()</code>ï¼šå”¤é†’æ‰€æœ‰ç­‰å¾…è¯¥å¯¹è±¡é”çš„çº¿ç¨‹ã€‚</p></li></ul></li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            lock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token comment">// do something</span></span>
<span class="line">        lock<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2ã€thread-sleep" tabindex="-1"><a class="header-anchor" href="#_2ã€thread-sleep"><span>2ã€Thread.sleep()</span></a></h3><ul><li><p>ä½¿å½“å‰çº¿ç¨‹è¿›å…¥â€œç¡çœ çŠ¶æ€â€ï¼Œåœ¨æŒ‡å®šæ—¶é—´å†…ä¸å‚ä¸ CPU è°ƒåº¦ã€‚</p></li><li><p>ä¸é”æ— å…³ï¼Œä¸é‡Šæ”¾ä»»ä½•å¯¹è±¡é”ã€‚</p></li><li><p>å¸¸ç”¨äºé™æµã€è½®è¯¢ç­‰å¾…ç­‰åœºæ™¯ã€‚</p></li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¼‘çœ 1ç§’</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3ã€lockçš„condition-await-signal-signalall" tabindex="-1"><a class="header-anchor" href="#_3ã€lockçš„condition-await-signal-signalall"><span>3ã€Lockçš„Condition.await() / signal() / signalAll()</span></a></h3><ul><li><p>ä¸ <code>ReentrantLock</code> é…åˆä½¿ç”¨ï¼ŒåŠŸèƒ½ç±»ä¼¼ <code>wait/notify</code>ï¼Œä½†æ›´çµæ´»ã€‚</p></li><li><p>ä¸€ä¸ª <code>Lock</code> å¯ä»¥åˆ›å»ºå¤šä¸ª <code>Condition</code>ï¼Œæ¯ä¸ªæ¡ä»¶å˜é‡ç»´æŠ¤ç‹¬ç«‹çš„ç­‰å¾…é˜Ÿåˆ—ã€‚</p></li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Condition</span> condition <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>conditionSatisfied<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            condition<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç­‰å¾…</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token comment">// æ¡ä»¶æ»¡è¶³åæ‰§è¡Œé€»è¾‘</span></span>
<span class="line">        condition<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// å”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4ã€locksupport-park-unpark" tabindex="-1"><a class="header-anchor" href="#_4ã€locksupport-park-unpark"><span>4ã€LockSupport.park() / unpark()</span></a></h3><ul><li><p>æ›´åº•å±‚çš„çº¿ç¨‹é˜»å¡ä¸å”¤é†’å·¥å…·ï¼Œå¹¿æ³›åº”ç”¨äºå¹¶å‘ç±»åº“ï¼ˆå¦‚ AQSï¼‰ã€‚</p></li><li><p>ä¸ä¾èµ–é”æœºåˆ¶ï¼Œçº¿ç¨‹å¯éšæ—¶ <code>park()</code> æš‚åœè‡ªå·±ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹é€šè¿‡ <code>unpark()</code> å”¤é†’ã€‚</p></li><li><p>æ”¯æŒå…ˆ <code>unpark()</code> å <code>park()</code> çš„è°ƒç”¨é¡ºåºï¼Œä¸ä¼šä¸¢å¤±ä¿¡å·ã€‚</p></li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// é˜»å¡å½“å‰çº¿ç¨‹</span></span>
<span class="line">    <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å”¤é†’æŒ‡å®šçº¿ç¨‹</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5ã€å°ç»“å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#_5ã€å°ç»“å¯¹æ¯”"><span>5ã€å°ç»“å¯¹æ¯”</span></a></h3><table><thead><tr><th>æœºåˆ¶</th><th>æ˜¯å¦é‡Šæ”¾é”</th><th>æ˜¯å¦ä¾èµ–é”</th><th>å”¤é†’ç²’åº¦</th><th>åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>wait/notify</code></td><td>æ˜¯</td><td>æ˜¯ï¼ˆsynchronizedï¼‰</td><td>ä¸å¯æ§ï¼ˆJVMå†³å®šï¼‰</td><td>çº¿ç¨‹åä½œï¼ˆç»å…¸ç”¨æ³•ï¼‰</td></tr><tr><td><code>sleep</code></td><td>å¦</td><td>å¦</td><td>æ— éœ€å”¤é†’</td><td>å®šæ—¶ç­‰å¾…</td></tr><tr><td><code>Condition</code></td><td>æ˜¯</td><td>æ˜¯ï¼ˆLockï¼‰</td><td>å¯æ§ï¼ˆæ¡ä»¶å˜é‡ï¼‰</td><td>ç²¾ç»†æ§åˆ¶å¹¶å‘</td></tr><tr><td><code>LockSupport</code></td><td>å¦</td><td>å¦</td><td>ç²¾ç¡®ï¼ˆçº¿ç¨‹çº§ï¼‰</td><td>é«˜çº§å¹¶å‘å·¥å…·å®ç°</td></tr></tbody></table><h2 id="å…«ã€çº¿ç¨‹æ± åŸºç¡€-executors" tabindex="-1"><a class="header-anchor" href="#å…«ã€çº¿ç¨‹æ± åŸºç¡€-executors"><span>å…«ã€çº¿ç¨‹æ± åŸºç¡€ï¼ˆExecutorsï¼‰</span></a></h2><h3 id="_1ã€executorså·¥å…·ç±»" tabindex="-1"><a class="header-anchor" href="#_1ã€executorså·¥å…·ç±»"><span>1ã€Executorså·¥å…·ç±»</span></a></h3><p><code>Executors</code> æ˜¯ Java ä¸­ç”¨äºç®¡ç†çº¿ç¨‹æ± çš„ä¸€ä¸ªå·¥å…·ç±»ï¼Œå®ƒæ˜¯ <code>java.util.concurrent</code> åŒ…çš„ä¸€éƒ¨åˆ†ã€‚é€šè¿‡ <code>Executors</code>ï¼Œ æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åˆ›å»ºå’Œç®¡ç†çº¿ç¨‹æ± ï¼Œé¿å…æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯ï¼Œæé«˜ç¨‹åºçš„æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h3 id="_2ã€-executors-çš„åˆ›å»ºæ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_2ã€-executors-çš„åˆ›å»ºæ–¹å¼"><span>2ã€ <code>Executors</code> çš„åˆ›å»ºæ–¹å¼</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">//åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œè¯¥çº¿ç¨‹æ± å¯ä»¥å®¹çº³å›ºå®šæ•°é‡çš„çº¿ç¨‹ã€‚å®ƒé€‚ç”¨äºè´Ÿè½½è¾ƒä¸ºç¨³å®šçš„åœºæ™¯ï¼Œçº¿ç¨‹æ•°å›ºå®šã€‚</span></span>
<span class="line">    <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">//åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± ã€‚è¯¥çº¿ç¨‹æ± ä¼šæ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹é•¿æ—¶é—´æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå®ƒä¼šè¢«å›æ”¶ã€‚</span></span>
<span class="line">    <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">//åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œæ‰€æœ‰ä»»åŠ¡ä¼šæŒ‰ç…§æäº¤çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</span></span>
<span class="line">    <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">//åˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼Œæ”¯æŒä»»åŠ¡çš„å»¶è¿Ÿæ‰§è¡Œå’Œå®šæœŸæ‰§è¡Œã€‚</span></span>
<span class="line">    <span class="token class-name">ScheduledExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newScheduledThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">//åˆ›å»ºä¸€ä¸ªå·¥ä½œçªƒå–çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± ä¼šè‡ªåŠ¨è°ƒæ•´çº¿ç¨‹çš„æ•°é‡ï¼Œé€‚ç”¨äºæœ‰å¤šä¸ªä»»åŠ¡éœ€è¦å¹¶å‘æ‰§è¡Œçš„åœºæ™¯ã€‚</span></span>
<span class="line">    <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newWorkStealingPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3ã€-invokeall-å’Œ-invokeany" tabindex="-1"><a class="header-anchor" href="#_3ã€-invokeall-å’Œ-invokeany"><span>3ã€ <code>invokeAll()</code> å’Œ <code>invokeAny()</code></span></a></h3><p>è¿™ä¸¤ä¸ªæ–¹æ³•ç”¨äºæ‰§è¡Œä»»åŠ¡ï¼š</p><ul><li><strong><code>invokeAll()</code></strong>ï¼šå°†ä¸€ç»„ä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± å¹¶ç­‰å¾…æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚è¿”å›ä¸€ä¸ª <code>List&lt;Future&gt;</code>ï¼Œè¡¨ç¤ºæ¯ä¸ªä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Callable</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    tasks<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    tasks<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> results <span class="token operator">=</span> executor<span class="token punctuation">.</span><span class="token function">invokeAll</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong><code>invokeAny()</code></strong>ï¼šå°†ä¸€ç»„ä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± ï¼Œå¹¶ç­‰å¾…å…¶ä¸­ä»»æ„ä¸€ä¸ªä»»åŠ¡å®Œæˆã€‚è¿”å›ç¬¬ä¸€ä¸ªå®Œæˆä»»åŠ¡çš„ç»“æœã€‚</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">Integer</span> result <span class="token operator">=</span> executor<span class="token punctuation">.</span><span class="token function">invokeAny</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_4ã€ä½¿ç”¨-future-å’Œ-callable" tabindex="-1"><a class="header-anchor" href="#_4ã€ä½¿ç”¨-future-å’Œ-callable"><span>4ã€ä½¿ç”¨ <code>Future</code> å’Œ <code>Callable</code></span></a></h3><p>å½“éœ€è¦è·å–ä»»åŠ¡æ‰§è¡Œç»“æœæ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨ <code>Future</code> å’Œ <code>Callable</code>ï¼š</p><ul><li><strong><code>Future</code></strong>ï¼šè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥è®¡ç®—çš„ç»“æœï¼Œå¯ä»¥é€šè¿‡ <code>get()</code> æ–¹æ³•è·å–ä»»åŠ¡æ‰§è¡Œç»“æœã€‚</li><li><strong><code>Callable</code></strong>ï¼šç±»ä¼¼äº <code>Runnable</code>ï¼Œä½†æ˜¯å¯ä»¥è¿”å›ç»“æœï¼Œå¹¶ä¸”å¯ä»¥æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> task <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// æ‰§è¡Œä»»åŠ¡</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Integer</span> result <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–ä»»åŠ¡æ‰§è¡Œç»“æœ</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5ã€executors-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_5ã€executors-æ€»ç»“"><span>5ã€Executors æ€»ç»“</span></a></h3><p><code>Executors</code> ç±»æä¾›äº†å¤šç§ç±»å‹çš„çº¿ç¨‹æ± ï¼Œå¯ä»¥æ ¹æ®ä»»åŠ¡çš„éœ€æ±‚é€‰æ‹©ä¸åŒç±»å‹çš„çº¿ç¨‹æ± ã€‚åˆç†ä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥æé«˜å¹¶å‘ç¨‹åºçš„æ€§èƒ½ï¼Œ å¹¶ä¸”é¿å…äº†æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹çš„å¤æ‚æ€§ï¼Œé¿å…äº†çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ã€‚</p><h3 id="_6ã€ä¸ºä½•ä¸å»ºè®®-executors" tabindex="-1"><a class="header-anchor" href="#_6ã€ä¸ºä½•ä¸å»ºè®®-executors"><span>6ã€ä¸ºä½•ä¸å»ºè®® Executorsï¼Ÿ</span></a></h3><p><strong>Executors</strong> è¿”å›çš„çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯å¦‚ä¸‹:</p><ul><li><p><strong>FixedThreadPool</strong> å’Œ <strong>SingleThreadPool</strong>: å…è®¸çš„è¯·æ±‚é˜Ÿåˆ—ï¼ˆ<strong>LinkedBlockingQueue</strong>ï¼‰é•¿åº¦ä¸º <strong>Integer.MAX VALUE</strong> ï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOMã€‚</p></li><li><p><strong>CachedThreadPool</strong>: å…è®¸çš„åˆ›å»ºçº¿ç¨‹æ•°é‡ä¸º <strong>LinkedBlockingQueue</strong>ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çš„çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOMã€‚</p></li></ul>`,57)),s("p",null,[n[27]||(n[27]=a("ç»¼ä¸Šï¼Œä¸ºäº†æ‰‹åŠ¨æ§åˆ¶çº¿ç¨‹æ± ï¼Œå»ºè®®è‡ªå·±ä½¿ç”¨ ")),e(t,{to:"/high-concurrency/1_thread_pool.html"},{default:p(()=>n[26]||(n[26]=[a("ThreadPoolExecutor")])),_:1}),n[28]||(n[28]=a(" æ¥åˆ›å»ºçº¿ç¨‹æ± "))]),n[36]||(n[36]=l('<h2 id="ä¹ã€threadlocal" tabindex="-1"><a class="header-anchor" href="#ä¹ã€threadlocal"><span>ä¹ã€ThreadLocal</span></a></h2><h3 id="_1ã€åŸºç¡€æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_1ã€åŸºç¡€æ¦‚å¿µ"><span>1ã€åŸºç¡€æ¦‚å¿µ</span></a></h3><p><code>ThreadLocal</code> æ˜¯ Java ä¸­çš„ä¸€ä¸ªç±»ï¼Œç”¨äºä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ä¸€ä¸ª <strong>ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬</strong>ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è¯¥å˜é‡çš„ä¸€ä¸ªç‹¬ç«‹å‰¯æœ¬ï¼Œå› æ­¤ä¸€ä¸ªçº¿ç¨‹çš„ä¿®æ”¹ä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„å‰¯æœ¬ã€‚</p><h4 id="ç‰¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#ç‰¹ç‚¹"><span><strong>ç‰¹ç‚¹ï¼š</strong></span></a></h4><ul><li><p>æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæŒæœ‰è‡ªå·±ç‹¬ç«‹çš„ <strong>ThreadLocal å˜é‡å‰¯æœ¬</strong>ã€‚</p></li><li><p>çº¿ç¨‹ä¹‹é—´çš„å˜é‡æ˜¯éš”ç¦»çš„ï¼Œä¸ä¼šç›¸äº’å½±å“ã€‚</p></li><li><p>é€šå¸¸ç”¨äºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä¿å­˜çº¿ç¨‹çº§åˆ«çš„å±€éƒ¨å˜é‡ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥ã€ç”¨æˆ·ä¼šè¯ç­‰ã€‚</p></li><li><p>çº¿ç¨‹ç»“æŸæ—¶ï¼Œç›¸å…³èµ„æºï¼ˆå¦‚å†…å­˜ï¼‰å¯ä»¥è¢«æ¸…ç†ã€‚</p></li></ul><h3 id="_2ã€åº•å±‚åŸç†" tabindex="-1"><a class="header-anchor" href="#_2ã€åº•å±‚åŸç†"><span>2ã€åº•å±‚åŸç†</span></a></h3><p><img src="'+b+'" alt="img_5.png"></p><h3 id="_3ã€å†…éƒ¨ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_3ã€å†…éƒ¨ç»“æ„"><span>3ã€å†…éƒ¨ç»“æ„</span></a></h3><p><img src="'+g+`" alt="img_5.png"></p><h3 id="_4ã€ç¤ºä¾‹ä»£ç " tabindex="-1"><a class="header-anchor" href="#_4ã€ç¤ºä¾‹ä»£ç "><span>4ã€ç¤ºä¾‹ä»£ç </span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadLocalExample</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> threadLocalValue <span class="token operator">=</span> <span class="token class-name">ThreadLocal</span><span class="token punctuation">.</span><span class="token function">withInitial</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// æ¨¡æ‹Ÿå¤šçº¿ç¨‹ç¯å¢ƒ</span></span>
<span class="line">        <span class="token class-name">Runnable</span> task <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">int</span> value <span class="token operator">=</span> threadLocalValue<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; initial value: &quot;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            threadLocalValue<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¿®æ”¹è¯¥çº¿ç¨‹çš„å‰¯æœ¬</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; modified value: &quot;</span> <span class="token operator">+</span> threadLocalValue<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// å¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹</span></span>
<span class="line">        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è¾“å‡ºï¼š</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Thread-0 initial value: 0</span>
<span class="line">Thread-1 initial value: 0</span>
<span class="line">Thread-0 modified value: 1</span>
<span class="line">Thread-1 modified value: 1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>çº¿ç¨‹ <code>Thread-0</code> å’Œ <code>Thread-1</code> æ‹¥æœ‰å„è‡ªç‹¬ç«‹çš„ <code>ThreadLocal</code> å˜é‡å‰¯æœ¬ï¼Œäº’ä¸å¹²æ‰°ã€‚</li></ul><h3 id="_5ã€é€‚ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#_5ã€é€‚ç”¨åœºæ™¯"><span>5ã€é€‚ç”¨åœºæ™¯</span></a></h3><ul><li><p><strong>çº¿ç¨‹å±€éƒ¨å˜é‡</strong>ï¼šä¾‹å¦‚å­˜å‚¨æ¯ä¸ªçº¿ç¨‹çš„è¿æ¥ä¿¡æ¯ã€æ—¥å¿—æ ‡è¯†ç¬¦ç­‰ã€‚</p></li><li><p><strong>é¿å…ç«äº‰æ¡ä»¶</strong>ï¼šé¿å…å¤šä¸ªçº¿ç¨‹å…±äº«å˜é‡æ—¶å¼•å‘çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p></li></ul><h2 id="åã€transmittablethreadlocal" tabindex="-1"><a class="header-anchor" href="#åã€transmittablethreadlocal"><span>åã€TransmittableThreadLocal</span></a></h2><h3 id="_1ã€åŸºç¡€æ¦‚å¿µ-1" tabindex="-1"><a class="header-anchor" href="#_1ã€åŸºç¡€æ¦‚å¿µ-1"><span>1ã€åŸºç¡€æ¦‚å¿µ</span></a></h3><p><code>TransmittableThreadLocal</code> æ˜¯ä¸€ç§åŸºäº <code>ThreadLocal</code> çš„å¢å¼ºç‰ˆæœ¬ï¼Œé€šå¸¸æ˜¯ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ <code>Alibaba</code> çš„ <strong>Arthas</strong> åº“ï¼‰æä¾›çš„ï¼Œå®ƒçš„ä¸»è¦ åŠŸèƒ½æ˜¯ <strong>æ”¯æŒè·¨çº¿ç¨‹ä¼ é€’ ThreadLocal çš„å€¼</strong>ï¼Œç‰¹åˆ«æ˜¯åœ¨å¼‚æ­¥ä»»åŠ¡æˆ–çº¿ç¨‹æ± ä¸­ï¼Œ<code>ThreadLocal</code> çš„å€¼ä¼šè¢«ä¸¢å¤±ï¼Œå› ä¸ºçº¿ç¨‹æ± çš„çº¿ç¨‹æ˜¯å¤ç”¨çš„ã€‚</p><ul><li><p>ä¸ <code>ThreadLocal</code> ä¸åŒï¼Œ<code>TransmittableThreadLocal</code> æ”¯æŒ <strong>è·¨çº¿ç¨‹ä¼ é€’å˜é‡</strong>ï¼Œå³ä½¿æ˜¯çº¿ç¨‹æ± æˆ–å¼‚æ­¥æ‰§è¡Œçš„æƒ…å†µï¼Œä¹Ÿå¯ä»¥ä¼ é€’å˜é‡çš„å€¼ã€‚</p></li><li><p>é€‚ç”¨äºçº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡æˆ–å¼‚æ­¥æ“ä½œï¼Œå®ƒå¯ä»¥ <strong>ç»§æ‰¿çˆ¶çº¿ç¨‹ä¸­çš„ <code>ThreadLocal</code> å€¼</strong>ï¼Œå³ä½¿çº¿ç¨‹è¢«æ± å¤ç”¨ï¼Œå€¼ä¹Ÿèƒ½æ­£ç¡®ä¼ é€’åˆ°å­çº¿ç¨‹ã€‚</p></li><li><p>çº¿ç¨‹æ± çš„å¤ç”¨ç‰¹æ€§ä¼šå¯¼è‡´ä¼ ç»Ÿ <code>ThreadLocal</code> çš„å€¼ä¸¢å¤±ï¼Œä½† <code>TransmittableThreadLocal</code> è§£å†³äº†è¿™ä¸€é—®é¢˜ï¼Œèƒ½å¤Ÿä¼ é€’è¿™äº›å€¼ã€‚</p></li></ul><h3 id="_2ã€ç¤ºä¾‹ä»£ç " tabindex="-1"><a class="header-anchor" href="#_2ã€ç¤ºä¾‹ä»£ç "><span>2ã€ç¤ºä¾‹ä»£ç </span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>ttl<span class="token punctuation">.</span></span><span class="token class-name">TransmittableThreadLocal</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransmittableThreadLocalExample</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">TransmittableThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> transmittableThreadLocalValue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransmittableThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        transmittableThreadLocalValue<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è®¾ç½®ä¸»çº¿ç¨‹ä¸­çš„å€¼</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// æ¨¡æ‹Ÿä¸€ä¸ªçº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡</span></span>
<span class="line">        <span class="token class-name">Runnable</span> task <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">Integer</span> value <span class="token operator">=</span> transmittableThreadLocalValue<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; value: &quot;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å­çº¿ç¨‹ç»§æ‰¿äº†ä¸»çº¿ç¨‹çš„å€¼</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// å¯åŠ¨çº¿ç¨‹æ± ä»»åŠ¡</span></span>
<span class="line">        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è¾“å‡ºï¼š</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Thread-0 value: 10</span>
<span class="line">Thread-1 value: 10</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™é‡Œï¼Œ<code>TransmittableThreadLocal</code> çš„å€¼ï¼ˆ<code>10</code>ï¼‰ä»ä¸»çº¿ç¨‹ä¼ é€’åˆ°å­çº¿ç¨‹ï¼Œå³ä½¿æ˜¯é€šè¿‡çº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡ã€‚</li></ul><h3 id="_3ã€é€‚ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#_3ã€é€‚ç”¨åœºæ™¯"><span>3ã€é€‚ç”¨åœºæ™¯</span></a></h3><ul><li><p><strong>è·¨çº¿ç¨‹ä¼ é€’</strong>ï¼šå½“éœ€è¦åœ¨å¼‚æ­¥æ‰§è¡Œï¼ˆä¾‹å¦‚çº¿ç¨‹æ± ï¼‰æˆ–ä»»åŠ¡ä¼ é€’ä¸­ä¿æŒ <code>ThreadLocal</code> å€¼æ—¶ã€‚</p></li><li><p><strong>å¢å¼ºçš„çº¿ç¨‹å®‰å…¨</strong>ï¼šç‰¹åˆ«é€‚ç”¨äºéœ€è¦åœ¨å¹¶è¡Œä»»åŠ¡ä¸­ä¼ é€’çˆ¶çº¿ç¨‹ä¸Šä¸‹æ–‡çš„åœºæ™¯ã€‚</p></li></ul><h3 id="_4ã€å¯¹æ¯”-threadlocal" tabindex="-1"><a class="header-anchor" href="#_4ã€å¯¹æ¯”-threadlocal"><span>4ã€å¯¹æ¯” Threadlocal</span></a></h3><table><thead><tr><th>ç‰¹æ€§</th><th><strong>ThreadLocal</strong></th><th><strong>TransmittableThreadLocal</strong></th></tr></thead><tbody><tr><td><strong>çº¿ç¨‹éš”ç¦»</strong></td><td>æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å‰¯æœ¬ï¼Œçº¿ç¨‹ä¹‹é—´äº’ä¸å¹²æ‰°</td><td>æ”¯æŒè·¨çº¿ç¨‹ä¼ é€’ï¼Œé€‚åˆçº¿ç¨‹æ± å’Œå¼‚æ­¥ä»»åŠ¡</td></tr><tr><td><strong>è·¨çº¿ç¨‹ä¼ é€’</strong></td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒè·¨çº¿ç¨‹ä¼ é€’ï¼ˆå°¤å…¶æ˜¯åœ¨çº¿ç¨‹æ± ä¸­ï¼‰</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>çº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œé¿å…çº¿ç¨‹ä¹‹é—´å…±äº«å˜é‡å¼•å‘çš„é—®é¢˜</td><td>è·¨çº¿ç¨‹ä»»åŠ¡ä¼ é€’ï¼Œçº¿ç¨‹æ± å’Œå¼‚æ­¥ä»»åŠ¡çš„ä¸Šä¸‹æ–‡ä¼ é€’</td></tr><tr><td><strong>åº“</strong></td><td>Java æ ‡å‡†åº“</td><td>é€šå¸¸æ˜¯ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ Alibabaï¼‰æä¾›çš„æ‰©å±•</td></tr></tbody></table><ul><li><p><strong><code>ThreadLocal</code></strong> æ›´é€‚åˆ <strong>å•çº¿ç¨‹å†…éƒ¨çš„çº¿ç¨‹å±€éƒ¨å­˜å‚¨</strong>ï¼Œé€‚ç”¨äºæ™®é€šçš„å¤šçº¿ç¨‹ç¼–ç¨‹ã€‚</p></li><li><p><strong><code>TransmittableThreadLocal</code></strong> é€‚åˆäº <strong>éœ€è¦ä¼ é€’ ThreadLocal å€¼çš„å¼‚æ­¥æ“ä½œæˆ–çº¿ç¨‹æ± </strong>ï¼Œè§£å†³äº†ä¼ ç»Ÿ <code>ThreadLocal</code> åœ¨è·¨çº¿ç¨‹åœºæ™¯ä¸‹ä¸¢å¤±çš„é—®é¢˜ã€‚</p></li></ul>`,30))])}const x=c(y,[["render",f],["__file","1_base.html.vue"]]),T=JSON.parse('{"path":"/java/1_base.html","title":"Java åŸºç¡€","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"ä¸€ã€Hashmapåˆ†æ","slug":"ä¸€ã€hashmapåˆ†æ","link":"#ä¸€ã€hashmapåˆ†æ","children":[{"level":3,"title":"1ã€å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰","slug":"_1ã€å“ˆå¸Œè¡¨-hash-table","link":"#_1ã€å“ˆå¸Œè¡¨-hash-table","children":[]},{"level":3,"title":"2ã€å“ˆå¸Œå†²çª","slug":"_2ã€å“ˆå¸Œå†²çª","link":"#_2ã€å“ˆå¸Œå†²çª","children":[]},{"level":3,"title":"3ã€æ‰©å®¹æœºåˆ¶","slug":"_3ã€æ‰©å®¹æœºåˆ¶","link":"#_3ã€æ‰©å®¹æœºåˆ¶","children":[]},{"level":3,"title":"4ã€æ—¶é—´å¤æ‚åº¦","slug":"_4ã€æ—¶é—´å¤æ‚åº¦","link":"#_4ã€æ—¶é—´å¤æ‚åº¦","children":[]}]},{"level":2,"title":"äºŒã€LinkedHashMapåˆ†æ","slug":"äºŒã€linkedhashmapåˆ†æ","link":"#äºŒã€linkedhashmapåˆ†æ","children":[{"level":3,"title":"1ã€æœ‰åºæ€§æ”¯æŒ","slug":"_1ã€æœ‰åºæ€§æ”¯æŒ","link":"#_1ã€æœ‰åºæ€§æ”¯æŒ","children":[]},{"level":3,"title":"2ã€éå†é¡ºåºå¯æ§","slug":"_2ã€éå†é¡ºåºå¯æ§","link":"#_2ã€éå†é¡ºåºå¯æ§","children":[]},{"level":3,"title":"3ã€åº”ç”¨åœºæ™¯ï¼šLRU ç¼“å­˜","slug":"_3ã€åº”ç”¨åœºæ™¯-lru-ç¼“å­˜","link":"#_3ã€åº”ç”¨åœºæ™¯-lru-ç¼“å­˜","children":[]},{"level":3,"title":"4ã€ç±»å…³ç³»å›¾","slug":"_4ã€ç±»å…³ç³»å›¾","link":"#_4ã€ç±»å…³ç³»å›¾","children":[]}]},{"level":2,"title":"ä¸‰ã€ConcurrentHashMapåˆ†æ","slug":"ä¸‰ã€concurrenthashmapåˆ†æ","link":"#ä¸‰ã€concurrenthashmapåˆ†æ","children":[{"level":3,"title":"1ã€åŸºæœ¬ç‰¹æ€§","slug":"_1ã€åŸºæœ¬ç‰¹æ€§","link":"#_1ã€åŸºæœ¬ç‰¹æ€§","children":[]},{"level":3,"title":"2ã€JDK 1.7 å’Œ 1.8 å¯¹æ¯”","slug":"_2ã€jdk-1-7-å’Œ-1-8-å¯¹æ¯”","link":"#_2ã€jdk-1-7-å’Œ-1-8-å¯¹æ¯”","children":[]}]},{"level":2,"title":"å››ã€ConcurrentHashMap ä¸ºä½•æ”¾å¼ƒåˆ†æ®µé”ï¼Ÿ","slug":"å››ã€concurrenthashmap-ä¸ºä½•æ”¾å¼ƒåˆ†æ®µé”","link":"#å››ã€concurrenthashmap-ä¸ºä½•æ”¾å¼ƒåˆ†æ®µé”","children":[{"level":3,"title":"1ã€JDK 1.7 å‰åˆ†æ®µé”å¼Šç«¯","slug":"_1ã€jdk-1-7-å‰åˆ†æ®µé”å¼Šç«¯","link":"#_1ã€jdk-1-7-å‰åˆ†æ®µé”å¼Šç«¯","children":[]},{"level":3,"title":"2ã€JDK 1.8 åçš„æ–°æ–¹æ¡ˆ","slug":"_2ã€jdk-1-8-åçš„æ–°æ–¹æ¡ˆ","link":"#_2ã€jdk-1-8-åçš„æ–°æ–¹æ¡ˆ","children":[]},{"level":3,"title":"3ã€ä¸¤å¥è¯æ€»ç»“å¯¹æ¯”","slug":"_3ã€ä¸¤å¥è¯æ€»ç»“å¯¹æ¯”","link":"#_3ã€ä¸¤å¥è¯æ€»ç»“å¯¹æ¯”","children":[]}]},{"level":2,"title":"å››ã€HashMapã€LinkedHashMapã€ConcurrentHashMapå¯¹æ¯”","slug":"å››ã€hashmapã€linkedhashmapã€concurrenthashmapå¯¹æ¯”","link":"#å››ã€hashmapã€linkedhashmapã€concurrenthashmapå¯¹æ¯”","children":[]},{"level":2,"title":"ä¸‰ã€TreeMapåˆ†æ","slug":"ä¸‰ã€treemapåˆ†æ","link":"#ä¸‰ã€treemapåˆ†æ","children":[{"level":3,"title":"1ã€æºç åˆ†æ","slug":"_1ã€æºç åˆ†æ","link":"#_1ã€æºç åˆ†æ","children":[]},{"level":3,"title":"2ã€ç›¸å…³ç±»å¯¹æ¯”","slug":"_2ã€ç›¸å…³ç±»å¯¹æ¯”","link":"#_2ã€ç›¸å…³ç±»å¯¹æ¯”","children":[]}]},{"level":2,"title":"å››ã€HashMapå’ŒHashTableå¯¹æ¯”","slug":"å››ã€hashmapå’Œhashtableå¯¹æ¯”","link":"#å››ã€hashmapå’Œhashtableå¯¹æ¯”","children":[{"level":3,"title":"1ã€ç»å…¸å¯¹æ¯”","slug":"_1ã€ç»å…¸å¯¹æ¯”","link":"#_1ã€ç»å…¸å¯¹æ¯”","children":[]},{"level":3,"title":"2ã€æ¨è ConcurrentHashMap","slug":"_2ã€æ¨è-concurrenthashmap","link":"#_2ã€æ¨è-concurrenthashmap","children":[]}]},{"level":2,"title":"äº”ã€çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼","slug":"äº”ã€çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼","link":"#äº”ã€çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼","children":[{"level":3,"title":"1ã€ç»§æ‰¿ Thread ç±»","slug":"_1ã€ç»§æ‰¿-thread-ç±»","link":"#_1ã€ç»§æ‰¿-thread-ç±»","children":[]},{"level":3,"title":"2ã€å®ç° Runnable æ¥å£","slug":"_2ã€å®ç°-runnable-æ¥å£","link":"#_2ã€å®ç°-runnable-æ¥å£","children":[]},{"level":3,"title":"3ã€å®ç° Callable æ¥å£ï¼ˆå¸¦è¿”å›å€¼çš„ä»»åŠ¡ï¼‰","slug":"_3ã€å®ç°-callable-æ¥å£-å¸¦è¿”å›å€¼çš„ä»»åŠ¡","link":"#_3ã€å®ç°-callable-æ¥å£-å¸¦è¿”å›å€¼çš„ä»»åŠ¡","children":[]},{"level":3,"title":"4ã€Future æ¥å£ï¼ˆä»»åŠ¡ç»“æœçš„è·å–ä¸æ§åˆ¶ï¼‰","slug":"_4ã€future-æ¥å£-ä»»åŠ¡ç»“æœçš„è·å–ä¸æ§åˆ¶","link":"#_4ã€future-æ¥å£-ä»»åŠ¡ç»“æœçš„è·å–ä¸æ§åˆ¶","children":[]},{"level":3,"title":"5ã€å…¶ä»–é«˜çº§æ–¹å¼","slug":"_5ã€å…¶ä»–é«˜çº§æ–¹å¼","link":"#_5ã€å…¶ä»–é«˜çº§æ–¹å¼","children":[]}]},{"level":2,"title":"å…­ã€volatile å…³é”®å­—","slug":"å…­ã€volatile-å…³é”®å­—","link":"#å…­ã€volatile-å…³é”®å­—","children":[{"level":3,"title":"1ã€çº¿ç¨‹å¯è§æ€§æœºåˆ¶","slug":"_1ã€çº¿ç¨‹å¯è§æ€§æœºåˆ¶","link":"#_1ã€çº¿ç¨‹å¯è§æ€§æœºåˆ¶","children":[]},{"level":3,"title":"2ã€ç¦æ­¢æŒ‡ä»¤é‡æ’åŸç†","slug":"_2ã€ç¦æ­¢æŒ‡ä»¤é‡æ’åŸç†","link":"#_2ã€ç¦æ­¢æŒ‡ä»¤é‡æ’åŸç†","children":[]},{"level":3,"title":"3ã€åŒé‡æ£€æŸ¥é”æ¡ˆä¾‹","slug":"_3ã€åŒé‡æ£€æŸ¥é”æ¡ˆä¾‹","link":"#_3ã€åŒé‡æ£€æŸ¥é”æ¡ˆä¾‹","children":[]},{"level":3,"title":"4ã€å¯¹æ¯”æ€»ç»“è¡¨","slug":"_4ã€å¯¹æ¯”æ€»ç»“è¡¨","link":"#_4ã€å¯¹æ¯”æ€»ç»“è¡¨","children":[]}]},{"level":2,"title":"ä¸ƒã€çº¿ç¨‹çš„ç­‰å¾…ä¸å”¤é†’æœºåˆ¶","slug":"ä¸ƒã€çº¿ç¨‹çš„ç­‰å¾…ä¸å”¤é†’æœºåˆ¶","link":"#ä¸ƒã€çº¿ç¨‹çš„ç­‰å¾…ä¸å”¤é†’æœºåˆ¶","children":[{"level":3,"title":"1ã€Objectçš„wait() / notify() / notifyAll()","slug":"_1ã€objectçš„wait-notify-notifyall","link":"#_1ã€objectçš„wait-notify-notifyall","children":[]},{"level":3,"title":"2ã€Thread.sleep()","slug":"_2ã€thread-sleep","link":"#_2ã€thread-sleep","children":[]},{"level":3,"title":"3ã€Lockçš„Condition.await() / signal() / signalAll()","slug":"_3ã€lockçš„condition-await-signal-signalall","link":"#_3ã€lockçš„condition-await-signal-signalall","children":[]},{"level":3,"title":"4ã€LockSupport.park() / unpark()","slug":"_4ã€locksupport-park-unpark","link":"#_4ã€locksupport-park-unpark","children":[]},{"level":3,"title":"5ã€å°ç»“å¯¹æ¯”","slug":"_5ã€å°ç»“å¯¹æ¯”","link":"#_5ã€å°ç»“å¯¹æ¯”","children":[]}]},{"level":2,"title":"å…«ã€çº¿ç¨‹æ± åŸºç¡€ï¼ˆExecutorsï¼‰","slug":"å…«ã€çº¿ç¨‹æ± åŸºç¡€-executors","link":"#å…«ã€çº¿ç¨‹æ± åŸºç¡€-executors","children":[{"level":3,"title":"1ã€Executorså·¥å…·ç±»","slug":"_1ã€executorså·¥å…·ç±»","link":"#_1ã€executorså·¥å…·ç±»","children":[]},{"level":3,"title":"2ã€ Executors çš„åˆ›å»ºæ–¹å¼","slug":"_2ã€-executors-çš„åˆ›å»ºæ–¹å¼","link":"#_2ã€-executors-çš„åˆ›å»ºæ–¹å¼","children":[]},{"level":3,"title":"3ã€ invokeAll() å’Œ invokeAny()","slug":"_3ã€-invokeall-å’Œ-invokeany","link":"#_3ã€-invokeall-å’Œ-invokeany","children":[]},{"level":3,"title":"4ã€ä½¿ç”¨ Future å’Œ Callable","slug":"_4ã€ä½¿ç”¨-future-å’Œ-callable","link":"#_4ã€ä½¿ç”¨-future-å’Œ-callable","children":[]},{"level":3,"title":"5ã€Executors æ€»ç»“","slug":"_5ã€executors-æ€»ç»“","link":"#_5ã€executors-æ€»ç»“","children":[]},{"level":3,"title":"6ã€ä¸ºä½•ä¸å»ºè®® Executorsï¼Ÿ","slug":"_6ã€ä¸ºä½•ä¸å»ºè®®-executors","link":"#_6ã€ä¸ºä½•ä¸å»ºè®®-executors","children":[]}]},{"level":2,"title":"ä¹ã€ThreadLocal","slug":"ä¹ã€threadlocal","link":"#ä¹ã€threadlocal","children":[{"level":3,"title":"1ã€åŸºç¡€æ¦‚å¿µ","slug":"_1ã€åŸºç¡€æ¦‚å¿µ","link":"#_1ã€åŸºç¡€æ¦‚å¿µ","children":[]},{"level":3,"title":"2ã€åº•å±‚åŸç†","slug":"_2ã€åº•å±‚åŸç†","link":"#_2ã€åº•å±‚åŸç†","children":[]},{"level":3,"title":"3ã€å†…éƒ¨ç»“æ„","slug":"_3ã€å†…éƒ¨ç»“æ„","link":"#_3ã€å†…éƒ¨ç»“æ„","children":[]},{"level":3,"title":"4ã€ç¤ºä¾‹ä»£ç ","slug":"_4ã€ç¤ºä¾‹ä»£ç ","link":"#_4ã€ç¤ºä¾‹ä»£ç ","children":[]},{"level":3,"title":"5ã€é€‚ç”¨åœºæ™¯","slug":"_5ã€é€‚ç”¨åœºæ™¯","link":"#_5ã€é€‚ç”¨åœºæ™¯","children":[]}]},{"level":2,"title":"åã€TransmittableThreadLocal","slug":"åã€transmittablethreadlocal","link":"#åã€transmittablethreadlocal","children":[{"level":3,"title":"1ã€åŸºç¡€æ¦‚å¿µ","slug":"_1ã€åŸºç¡€æ¦‚å¿µ-1","link":"#_1ã€åŸºç¡€æ¦‚å¿µ-1","children":[]},{"level":3,"title":"2ã€ç¤ºä¾‹ä»£ç ","slug":"_2ã€ç¤ºä¾‹ä»£ç ","link":"#_2ã€ç¤ºä¾‹ä»£ç ","children":[]},{"level":3,"title":"3ã€é€‚ç”¨åœºæ™¯","slug":"_3ã€é€‚ç”¨åœºæ™¯","link":"#_3ã€é€‚ç”¨åœºæ™¯","children":[]},{"level":3,"title":"4ã€å¯¹æ¯” Threadlocal","slug":"_4ã€å¯¹æ¯”-threadlocal","link":"#_4ã€å¯¹æ¯”-threadlocal","children":[]}]}],"git":{"updatedTime":1747496471000,"contributors":[{"name":"Clarence","username":"Clarence","email":"1154937362@qq.com","commits":17,"url":"https://github.com/Clarence"},{"name":"hanchen","username":"hanchen","email":"1154937362@qq.com","commits":10,"url":"https://github.com/hanchen"},{"name":"hello0709","username":"hello0709","email":"1154937362@qq.com","commits":1,"url":"https://github.com/hello0709"}]},"filePathRelative":"java/1_base.md"}');export{x as comp,T as data};
