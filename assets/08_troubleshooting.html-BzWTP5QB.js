import{_ as a,c as n,a as e,o as l}from"./app-B3Ybswz4.js";const p={};function i(t,s){return l(),n("div",null,s[0]||(s[0]=[e(`<h1 id="jvm错误排查" tabindex="-1"><a class="header-anchor" href="#jvm错误排查"><span>JVM错误排查</span></a></h1><h2 id="常见错误类型" tabindex="-1"><a class="header-anchor" href="#常见错误类型"><span>常见错误类型</span></a></h2><h3 id="outofmemoryerror-java-heap-space" tabindex="-1"><a class="header-anchor" href="#outofmemoryerror-java-heap-space"><span>OutOfMemoryError: Java heap space</span></a></h3><p><strong>堆内存溢出</strong></p><p><strong>原因</strong>：</p><ul><li>对象太多，堆内存不足</li><li>内存泄漏，对象无法回收</li><li>大对象分配失败</li></ul><h3 id="outofmemoryerror-metaspace" tabindex="-1"><a class="header-anchor" href="#outofmemoryerror-metaspace"><span>OutOfMemoryError: Metaspace</span></a></h3><p><strong>方法区（元空间）溢出</strong></p><p><strong>原因</strong>：</p><ul><li>加载的类太多</li><li>类加载器泄漏</li><li>动态代理、反射使用过多</li></ul><h3 id="stackoverflowerror" tabindex="-1"><a class="header-anchor" href="#stackoverflowerror"><span>StackOverflowError</span></a></h3><p><strong>递归过深</strong></p><p><strong>原因</strong>：</p><ul><li>递归调用太深</li><li>方法调用层次过深</li><li>线程栈太小</li></ul><h3 id="类加载失败" tabindex="-1"><a class="header-anchor" href="#类加载失败"><span>类加载失败</span></a></h3><p><strong>ClassNotFound、NoClassDefFound</strong></p><p><strong>原因</strong>：</p><ul><li>类路径配置错误</li><li>依赖缺失</li><li>类加载器问题</li></ul><h2 id="详细排查步骤" tabindex="-1"><a class="header-anchor" href="#详细排查步骤"><span>详细排查步骤</span></a></h2><h3 id="outofmemoryerror-java-heap-space-1" tabindex="-1"><a class="header-anchor" href="#outofmemoryerror-java-heap-space-1"><span>OutOfMemoryError: Java heap space</span></a></h3><h4 id="步骤-1-确认错误类型" tabindex="-1"><a class="header-anchor" href="#步骤-1-确认错误类型"><span>步骤 1：确认错误类型</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查看错误日志</span></span>
<span class="line"><span class="token function">grep</span> <span class="token string">&quot;OutOfMemoryError&quot;</span> app.log</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看堆内存使用</span></span>
<span class="line">jstat <span class="token parameter variable">-gc</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token number">1000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤-2-分析-gc-日志" tabindex="-1"><a class="header-anchor" href="#步骤-2-分析-gc-日志"><span>步骤 2：分析 GC 日志</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查看 Full GC 频率</span></span>
<span class="line"><span class="token function">grep</span> <span class="token string">&quot;Full GC&quot;</span> gc.log <span class="token operator">|</span> <span class="token function">tail</span> <span class="token parameter variable">-20</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看 GC 停顿时间</span></span>
<span class="line"><span class="token function">grep</span> <span class="token string">&quot;Pause&quot;</span> gc.log <span class="token operator">|</span> <span class="token function">tail</span> <span class="token parameter variable">-20</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤-3-查看堆内存使用" tabindex="-1"><a class="header-anchor" href="#步骤-3-查看堆内存使用"><span>步骤 3：查看堆内存使用</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 实时监控堆内存</span></span>
<span class="line">jstat <span class="token parameter variable">-gc</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token number">1000</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 输出说明：</span></span>
<span class="line"><span class="token comment"># - O：老年代使用率</span></span>
<span class="line"><span class="token comment"># - FGC：Full GC 次数</span></span>
<span class="line"><span class="token comment"># - FGCT：Full GC 总时间</span></span>
<span class="line"><span class="token comment"># - OGCMN/OGCMX：老年代最小/最大容量</span></span>
<span class="line"><span class="token comment"># - OGC：老年代当前容量</span></span>
<span class="line"><span class="token comment"># - OC：老年代已使用</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤-4-导出堆快照" tabindex="-1"><a class="header-anchor" href="#步骤-4-导出堆快照"><span>步骤 4：导出堆快照</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 方式 1：自动导出（OOM 时）</span></span>
<span class="line"><span class="token parameter variable">-XX:+HeapDumpOnOutOfMemoryError</span> <span class="token parameter variable">-XX:HeapDumpPath</span><span class="token operator">=</span>/tmp/</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 方式 2：手动导出</span></span>
<span class="line">jmap <span class="token parameter variable">-dump:format</span><span class="token operator">=</span>b,file<span class="token operator">=</span>heap.hprof <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 方式 3：只导出存活对象</span></span>
<span class="line">jmap -dump:live,format<span class="token operator">=</span>b,file<span class="token operator">=</span>heap.hprof <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤-5-mat-分析" tabindex="-1"><a class="header-anchor" href="#步骤-5-mat-分析"><span>步骤 5：MAT 分析</span></a></h4><ol><li><p><strong>打开 heap dump</strong></p><ul><li>File → Open Heap Dump</li><li>选择 heap.hprof 文件</li></ul></li><li><p><strong>查看 Leak Suspects Report</strong></p><ul><li>自动分析可能的内存泄漏</li><li>查看占用内存最大的对象</li></ul></li><li><p><strong>查看 Dominator Tree</strong></p><ul><li>按对象占用内存排序</li><li>右键对象 → Path to GC Roots</li><li>查看对象引用链</li></ul></li><li><p><strong>查找泄漏源</strong></p><ul><li>检查静态集合（Map、List）</li><li>检查监听器未移除</li><li>检查线程未关闭</li><li>检查缓存未清理</li></ul></li></ol><h4 id="步骤-6-解决方法" tabindex="-1"><a class="header-anchor" href="#步骤-6-解决方法"><span>步骤 6：解决方法</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 增加堆内存</span></span>
<span class="line"><span class="token parameter variable">-Xms8g</span> <span class="token parameter variable">-Xmx8g</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 调整新生代比例</span></span>
<span class="line"><span class="token parameter variable">-XX:NewRatio</span><span class="token operator">=</span><span class="token number">2</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 优化代码</span></span>
<span class="line"><span class="token comment"># - 及时释放对象引用</span></span>
<span class="line"><span class="token comment"># - 使用弱引用（WeakReference）</span></span>
<span class="line"><span class="token comment"># - 使用对象池</span></span>
<span class="line"><span class="token comment"># - 清理缓存</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="outofmemoryerror-metaspace-1" tabindex="-1"><a class="header-anchor" href="#outofmemoryerror-metaspace-1"><span>OutOfMemoryError: Metaspace</span></a></h3><h4 id="步骤-1-确认错误类型-1" tabindex="-1"><a class="header-anchor" href="#步骤-1-确认错误类型-1"><span>步骤 1：确认错误类型</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查看错误日志</span></span>
<span class="line"><span class="token function">grep</span> <span class="token string">&quot;Metaspace&quot;</span> app.log</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看元空间使用</span></span>
<span class="line">jstat <span class="token parameter variable">-gc</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token number">1000</span></span>
<span class="line"><span class="token comment"># 关注：MCMN/MCMX/MC/CCSC/CCSU</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤-2-查看类加载器统计" tabindex="-1"><a class="header-anchor" href="#步骤-2-查看类加载器统计"><span>步骤 2：查看类加载器统计</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查看类加载器统计</span></span>
<span class="line">jmap <span class="token parameter variable">-clstats</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看加载的类数量</span></span>
<span class="line">jmap <span class="token parameter variable">-clstats</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;classes&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤-3-查找类加载器泄漏" tabindex="-1"><a class="header-anchor" href="#步骤-3-查找类加载器泄漏"><span>步骤 3：查找类加载器泄漏</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查找重复加载的类</span></span>
<span class="line">jmap <span class="token parameter variable">-clstats</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;com.example&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查找类加载器数量</span></span>
<span class="line">jmap <span class="token parameter variable">-clstats</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;classloader&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤-4-解决方法" tabindex="-1"><a class="header-anchor" href="#步骤-4-解决方法"><span>步骤 4：解决方法</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 增加元空间大小</span></span>
<span class="line"><span class="token parameter variable">-XX:MetaspaceSize</span><span class="token operator">=</span>512m <span class="token parameter variable">-XX:MaxMetaspaceSize</span><span class="token operator">=</span>1g</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 跟踪类加载</span></span>
<span class="line"><span class="token parameter variable">-XX:+TraceClassLoading</span> <span class="token parameter variable">-XX:+TraceClassUnloading</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 优化代码</span></span>
<span class="line"><span class="token comment"># - 避免重复创建类加载器</span></span>
<span class="line"><span class="token comment"># - 及时释放类加载器引用</span></span>
<span class="line"><span class="token comment"># - 减少动态代理和反射使用</span></span>
<span class="line"><span class="token comment"># - 清理未使用的类</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="stackoverflowerror-1" tabindex="-1"><a class="header-anchor" href="#stackoverflowerror-1"><span>StackOverflowError</span></a></h3><h4 id="步骤-1-确认错误类型-2" tabindex="-1"><a class="header-anchor" href="#步骤-1-确认错误类型-2"><span>步骤 1：确认错误类型</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查看错误日志</span></span>
<span class="line"><span class="token function">grep</span> <span class="token string">&quot;StackOverflowError&quot;</span> app.log</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看线程堆栈</span></span>
<span class="line">jstack <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token operator">&gt;</span> thread_dump.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤-2-分析线程堆栈" tabindex="-1"><a class="header-anchor" href="#步骤-2-分析线程堆栈"><span>步骤 2：分析线程堆栈</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查找递归调用</span></span>
<span class="line"><span class="token function">grep</span> <span class="token parameter variable">-A</span> <span class="token number">100</span> <span class="token string">&quot;StackOverflowError&quot;</span> thread_dump.txt</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查找重复的方法调用</span></span>
<span class="line"><span class="token function">grep</span> <span class="token string">&quot;at com.example&quot;</span> thread_dump.txt <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-50</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤-3-解决方法" tabindex="-1"><a class="header-anchor" href="#步骤-3-解决方法"><span>步骤 3：解决方法</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 增加栈大小（临时方案）</span></span>
<span class="line"><span class="token parameter variable">-Xss2m</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 优化代码</span></span>
<span class="line"><span class="token comment"># - 减少递归深度</span></span>
<span class="line"><span class="token comment"># - 改用迭代</span></span>
<span class="line"><span class="token comment"># - 优化算法复杂度</span></span>
<span class="line"><span class="token comment"># - 检查循环依赖</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="类加载失败-1" tabindex="-1"><a class="header-anchor" href="#类加载失败-1"><span>类加载失败</span></a></h3><h4 id="步骤-1-确认错误类型-3" tabindex="-1"><a class="header-anchor" href="#步骤-1-确认错误类型-3"><span>步骤 1：确认错误类型</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查看错误日志</span></span>
<span class="line"><span class="token function">grep</span> <span class="token string">&quot;ClassNotFoundException\\|NoClassDefFoundError&quot;</span> app.log</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看类路径</span></span>
<span class="line">jinfo <span class="token parameter variable">-sysprops</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;java.class.path&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤-2-检查类路径" tabindex="-1"><a class="header-anchor" href="#步骤-2-检查类路径"><span>步骤 2：检查类路径</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查看类路径</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token variable">$CLASSPATH</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看启动参数</span></span>
<span class="line">jinfo <span class="token parameter variable">-flags</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤-3-检查依赖" tabindex="-1"><a class="header-anchor" href="#步骤-3-检查依赖"><span>步骤 3：检查依赖</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查看加载的类</span></span>
<span class="line">jmap <span class="token parameter variable">-clstats</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查找类加载器</span></span>
<span class="line">jmap <span class="token parameter variable">-clstats</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;classloader&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤-4-解决方法-1" tabindex="-1"><a class="header-anchor" href="#步骤-4-解决方法-1"><span>步骤 4：解决方法</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 添加类路径</span></span>
<span class="line"><span class="token function">java</span> <span class="token parameter variable">-cp</span> /path/to/classes:/path/to/lib/* app.jar</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 检查依赖</span></span>
<span class="line"><span class="token comment"># - 确认所有依赖都在类路径中</span></span>
<span class="line"><span class="token comment"># - 检查依赖版本冲突</span></span>
<span class="line"><span class="token comment"># - 使用 Maven/Gradle 管理依赖</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 检查类加载器</span></span>
<span class="line"><span class="token comment"># - 确认类加载器层次结构</span></span>
<span class="line"><span class="token comment"># - 检查是否打破双亲委派</span></span>
<span class="line"><span class="token comment"># - 确认类加载器隔离</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="常见问题排查思路" tabindex="-1"><a class="header-anchor" href="#常见问题排查思路"><span>常见问题排查思路</span></a></h2><h3 id="_1-查看-jvm-启动参数" tabindex="-1"><a class="header-anchor" href="#_1-查看-jvm-启动参数"><span>1. 查看 JVM 启动参数</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查看启动参数</span></span>
<span class="line">jinfo <span class="token parameter variable">-flags</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看系统属性</span></span>
<span class="line">jinfo <span class="token parameter variable">-sysprops</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看堆、栈、元空间配置</span></span>
<span class="line">jinfo <span class="token parameter variable">-flags</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token string">&quot;Heap|Stack|Metaspace&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-分析-gc-日志" tabindex="-1"><a class="header-anchor" href="#_2-分析-gc-日志"><span>2. 分析 GC 日志</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查看 GC 频率</span></span>
<span class="line"><span class="token function">grep</span> <span class="token string">&quot;GC&quot;</span> gc.log <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看 Full GC 频率</span></span>
<span class="line"><span class="token function">grep</span> <span class="token string">&quot;Full GC&quot;</span> gc.log <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看 GC 停顿时间</span></span>
<span class="line"><span class="token function">grep</span> <span class="token string">&quot;Pause&quot;</span> gc.log <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $NF}&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用 GCViewer 可视化</span></span>
<span class="line"><span class="token function">java</span> <span class="token parameter variable">-jar</span> gcviewer.jar gc.log</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-查看内存占用情况" tabindex="-1"><a class="header-anchor" href="#_3-查看内存占用情况"><span>3. 查看内存占用情况</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查看堆内存使用</span></span>
<span class="line">jstat <span class="token parameter variable">-gc</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token number">1000</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看堆配置</span></span>
<span class="line">jmap <span class="token parameter variable">-heap</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看对象统计</span></span>
<span class="line">jmap <span class="token parameter variable">-histo:live</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-20</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-检查线程状态" tabindex="-1"><a class="header-anchor" href="#_4-检查线程状态"><span>4. 检查线程状态</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查看线程堆栈</span></span>
<span class="line">jstack <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token operator">&gt;</span> thread_dump.txt</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查找死锁</span></span>
<span class="line">jstack <span class="token parameter variable">-l</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-A</span> <span class="token number">20</span> <span class="token string">&quot;deadlock&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查找 BLOCKED 线程</span></span>
<span class="line">jstack <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-A</span> <span class="token number">5</span> <span class="token string">&quot;BLOCKED&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查找线程数量</span></span>
<span class="line">jstack <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;java.lang.Thread.State&quot;</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-dump-内存快照" tabindex="-1"><a class="header-anchor" href="#_5-dump-内存快照"><span>5. Dump 内存快照</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 导出堆快照</span></span>
<span class="line">jmap <span class="token parameter variable">-dump:format</span><span class="token operator">=</span>b,file<span class="token operator">=</span>heap.hprof <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 导出线程快照</span></span>
<span class="line">jstack <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token operator">&gt;</span> thread_dump.txt</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 导出类加载器统计</span></span>
<span class="line">jmap <span class="token parameter variable">-clstats</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token operator">&gt;</span> clstats.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-检查类加载器泄漏" tabindex="-1"><a class="header-anchor" href="#_6-检查类加载器泄漏"><span>6. 检查类加载器泄漏</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 查看类加载器统计</span></span>
<span class="line">jmap <span class="token parameter variable">-clstats</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查找重复加载的类</span></span>
<span class="line">jmap <span class="token parameter variable">-clstats</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;com.example&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看类加载器数量</span></span>
<span class="line">jmap <span class="token parameter variable">-clstats</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;classloader&quot;</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="排查流程总结" tabindex="-1"><a class="header-anchor" href="#排查流程总结"><span>排查流程总结</span></a></h2><h3 id="内存问题" tabindex="-1"><a class="header-anchor" href="#内存问题"><span>内存问题</span></a></h3><ol><li>确认错误类型（堆溢出、元空间溢出）</li><li>查看 GC 日志，分析 GC 频率和停顿时间</li><li>使用 jstat 实时监控内存使用</li><li>导出堆快照，使用 MAT 分析</li><li>查找内存泄漏源</li><li>调整 JVM 参数或优化代码</li></ol><h3 id="线程问题" tabindex="-1"><a class="header-anchor" href="#线程问题"><span>线程问题</span></a></h3><ol><li>查看线程堆栈</li><li>查找死锁、BLOCKED 线程</li><li>分析线程状态和调用栈</li><li>修复代码中的锁问题</li></ol><h3 id="类加载问题" tabindex="-1"><a class="header-anchor" href="#类加载问题"><span>类加载问题</span></a></h3><ol><li>查看类路径配置</li><li>检查依赖是否完整</li><li>查看类加载器统计</li><li>检查类加载器泄漏</li></ol><h3 id="性能问题" tabindex="-1"><a class="header-anchor" href="#性能问题"><span>性能问题</span></a></h3><ol><li>启用 GC 日志</li><li>使用 GCViewer 分析</li><li>使用 jstat 监控 GC</li><li>调整 GC 参数</li><li>优化代码和算法</li></ol>`,79)]))}const c=a(p,[["render",i],["__file","08_troubleshooting.html.vue"]]),o=JSON.parse('{"path":"/jvm/08_troubleshooting.html","title":"JVM错误排查","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"常见错误类型","slug":"常见错误类型","link":"#常见错误类型","children":[{"level":3,"title":"OutOfMemoryError: Java heap space","slug":"outofmemoryerror-java-heap-space","link":"#outofmemoryerror-java-heap-space","children":[]},{"level":3,"title":"OutOfMemoryError: Metaspace","slug":"outofmemoryerror-metaspace","link":"#outofmemoryerror-metaspace","children":[]},{"level":3,"title":"StackOverflowError","slug":"stackoverflowerror","link":"#stackoverflowerror","children":[]},{"level":3,"title":"类加载失败","slug":"类加载失败","link":"#类加载失败","children":[]}]},{"level":2,"title":"详细排查步骤","slug":"详细排查步骤","link":"#详细排查步骤","children":[{"level":3,"title":"OutOfMemoryError: Java heap space","slug":"outofmemoryerror-java-heap-space-1","link":"#outofmemoryerror-java-heap-space-1","children":[]},{"level":3,"title":"OutOfMemoryError: Metaspace","slug":"outofmemoryerror-metaspace-1","link":"#outofmemoryerror-metaspace-1","children":[]},{"level":3,"title":"StackOverflowError","slug":"stackoverflowerror-1","link":"#stackoverflowerror-1","children":[]},{"level":3,"title":"类加载失败","slug":"类加载失败-1","link":"#类加载失败-1","children":[]}]},{"level":2,"title":"常见问题排查思路","slug":"常见问题排查思路","link":"#常见问题排查思路","children":[{"level":3,"title":"1. 查看 JVM 启动参数","slug":"_1-查看-jvm-启动参数","link":"#_1-查看-jvm-启动参数","children":[]},{"level":3,"title":"2. 分析 GC 日志","slug":"_2-分析-gc-日志","link":"#_2-分析-gc-日志","children":[]},{"level":3,"title":"3. 查看内存占用情况","slug":"_3-查看内存占用情况","link":"#_3-查看内存占用情况","children":[]},{"level":3,"title":"4. 检查线程状态","slug":"_4-检查线程状态","link":"#_4-检查线程状态","children":[]},{"level":3,"title":"5. Dump 内存快照","slug":"_5-dump-内存快照","link":"#_5-dump-内存快照","children":[]},{"level":3,"title":"6. 检查类加载器泄漏","slug":"_6-检查类加载器泄漏","link":"#_6-检查类加载器泄漏","children":[]}]},{"level":2,"title":"排查流程总结","slug":"排查流程总结","link":"#排查流程总结","children":[{"level":3,"title":"内存问题","slug":"内存问题","link":"#内存问题","children":[]},{"level":3,"title":"线程问题","slug":"线程问题","link":"#线程问题","children":[]},{"level":3,"title":"类加载问题","slug":"类加载问题","link":"#类加载问题","children":[]},{"level":3,"title":"性能问题","slug":"性能问题","link":"#性能问题","children":[]}]}],"git":{"updatedTime":1771047071000,"contributors":[{"name":"hello0709","username":"hello0709","email":"1154937362@qq.com","commits":1,"url":"https://github.com/hello0709"}]},"filePathRelative":"jvm/08_troubleshooting.md"}');export{c as comp,o as data};
