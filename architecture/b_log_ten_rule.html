<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="images/logo.png"><title>打印日志最佳实践 | Clarence Java Doc</title><meta name="description" content="实践是检验真理的唯一标准">
    <link rel="preload" href="/clarence-java-doc/assets/style-CfjadihE.css" as="style"><link rel="stylesheet" href="/clarence-java-doc/assets/style-CfjadihE.css">
    <link rel="modulepreload" href="/clarence-java-doc/assets/app-Du6cbhZk.js"><link rel="modulepreload" href="/clarence-java-doc/assets/b_log_ten_rule.html-CjOfup3Q.js">
    <link rel="prefetch" href="/clarence-java-doc/assets/index.html-CVkYDN-I.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_ai.html-mq-U8U1f.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_model.html-CsIPyi6g.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_ollama.html-3RhH0Ovw.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_base_0_complexity.html-CSXEZXb_.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_base_1_list.html-BwyOaUtv.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_base_2_stack_queue.html-CZu0_Du8.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_base_3_hash.html-BlHVmVMY.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_base_4_tree.html-KTOOsWor.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_base_5_heap.html-B5OzmqCQ.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_base_6_graph.html-Bms2f5n1.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_base_7_search.html-BT34IpMv.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_base_8_sort.html-Cwp-hnWZ.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_base_9_divide_and_conquer.html-Ce0uRAmd.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_base_a_reverse.html-BFmaO-DM.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_base_b_dynamic_program.html-oBs0dHMd.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_base_c_greedy.html-CU_QKNnF.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_leet_code.html-Dc9owV0b.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_huawei_code.html-Cvq9rMYT.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_system_structure.html-Zyerrpkm.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_cold_hot_data.html-jsUrfsbn.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_database_100_.html-6HCpdXNh.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/3_team_git_guidelines.html-Pqr98zss.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/5_object_storage_service.html-D_ik8AqZ.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/6_idempotence.html-BWmeidNU.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/7_team_dev_rule.html-zIY6rg4P.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/8_software_architecture.html-Bak4FNpv.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/9_ddd_architecture.html-CT4lZTKE.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/a_access_control_model.html-BPoLm_oi.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/c_master_data_manage.html-bqQg932e.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_redis.html-BiCbwhrE.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_caffeine.html-BVUx7aUP.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/3_jetcache.html-B-rxlX1R.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/4_cache_rule.html-DNdLMPtW.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/z_interview.html-BpgVXot3.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_linux.html-CObfbTYZ.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_linux_0_centos.html-srZ3b85o.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_linux_1_ubuntun.html-Byklaz9k.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_linux_2_debian.html-BQ0bVe8r.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_virtual.html-oAAhKmQK.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_virtual_hyperv.html-sRfUkKkw.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_virtual_vmware.html-BpnnpV79.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_virtual_wsl.html-BHdx4aoV.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_virtual_z_vm_tool.html-DQWjZKDV.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/3_docker.html-UXvmt7b4.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/4_kubernetes.html-BLayDrhQ.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_mysql.html-lkqWMSEj.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_mysql_feature.html-DEIlLwSt.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_mysql_maria_db.html-t5juO8Xq.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_postgres.html-1ymw7arr.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_postgres_feature.html-BHbTtIUN.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_other_rdbms.html-Ds0F8MkV.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_orm_framework.html-D_SbxnqT.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/3_column_db.html-DOo4BcYt.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/4_distributed_db.html-DliZJELz.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/5_time_series_db.html-T3gne6c6.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/6_document_db.html-C9JTiWaI.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/7_search_db.html-B49AvCmo.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/8_sharding.html-DK0qFefd.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/9_cdc_tools.html-CsHxUiFf.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/a_mbcj_source_code.html-DsCbRNlI.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/z_interview.html-Ben8j9Sr.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_distributed.html-Bx63aema.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_theorem.html-D1olB1xM.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_gateway.html-C6ZUB8Sp.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/3_lock.html-BuNfuEmH.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/4_transaction.html-DSqtD31e.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/5_session.html-DlN40aH1.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_high_availability.html-zNBBNICc.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_rate_limiting.html-U4xBls9f.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_circuit_breaking.html-Bi1Eibfm.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/3_fallback_mechanism.html-Di-PJaDf.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/99_todo.html-BYxXyINk.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_concurrent.html-PtKcgfSm.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_thread_pool.html-JM1HisNh.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_hc_system.html-BibhX38s.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/3_Indicator.html-BH8EhseA.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/4_stress_test.html-RIvkF23u.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/6_java_profilers.html-CdNeycU7.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_java.html-5sSYJpBg.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_db.html-CJRzEHRA.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_cache.html-B2b8GxXY.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/4_jvm.html-D_UJOeCo.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/5_spring.html-CImIopNR.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/6_spring_cloud.html-woSAWBtc.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/7_mq.html-Bh8o_G5U.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/z_to_be_continue.html-BwKNhBSL.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_base.html-IfDiHNnM.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_solution.html-CEbnTK5U.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/3_protocol.html-Ct0BOzDb.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/4_open_source.html-CIuozLgu.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_base.html-wBzmh3X9.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_advanced.html-IeMkK0FC.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/3_topic_time.html-fi16xFf1.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/4_xxx.html-GcLZTpZq.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/a_tool.html-0g9NxxN-.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/b_feature.html-CBrzcL9E.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/z_interview.html-DHcWSv6J.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_jvm_memory_base.html-CqgmlGcb.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_class_loaders.html-CW29jB3i.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/3_delegation_model.html-BYpRjyJ7.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/4_garbage_collectors.html-DhJmrfYg.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/5_gc_recommendations.html-CpDhhkzc.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/6_jvm_options.html-CvVj_J_h.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/7_jvm_tool_performence.html-DN5olNTa.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/8_problem_solution.html-DcICf9mE.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/z_interview.html-ZxrAoBPg.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_mq.html-LsgMn7xk.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_kafka.html-DMgT1qUO.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/3_rocketmq.html-Jl6jkkVd.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/4_rabbitmq.html-DXqed_q7.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/other_mq.html-eiVl7xvK.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/z_interview.html-BIgFhvyP.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_base_concept.html-Bc4CMsrg.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_dis_or_advantages.html-DDMDEVC_.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/3_mono-to-micro.html-DTj9b9JF.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/4_core_component.html-DnxnK71F.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/5_devops_monitor.html-CqWdJq9P.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/6_solutions.html-B_6eumLi.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/7_microservices_patterns.html-D4-2sKPa.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/99_best_practise.html-CwYwBnPh.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/z_interview.html-DWRed60T.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_stick_split.html-Db-Ogw1S.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_io_model.html-CfGroz0T.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_reactor.html-vWSVYhgW.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/3_websocket.html-g9K1KghQ.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/4_sse.html-iO7HdHIO.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/5_netty-desc.html-DQ6EE5wO.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_design_intro.html-vBGioyzO.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_singleton.html-DI_p3MST.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_factory.html-DjFgtqCP.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/3_strategy.html-DRwSOLqc.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/4_chain_of_responsibility.html-D4iEgbBN.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_protocols_base.html-BQZqNYB7.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_network_communication.html-B8pnqLAt.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_iot-Industrial-ommunication.html-xTUuLkk1.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/3_data-exchange_remote_call.html-Da61eLN4.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/4_security-protocols.html-BLHe97UO.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/5_file-transfer-protocols.html-BWjC9zmc.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/6_database-access-protocols.html-8o550ImK.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/7-email-communication-protocols.html-CitlR57p.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/8-distributed-system-protocols.html-D5JjDB54.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_scene.html-BiqWGiag.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_big_data.html-BRq_xxxV.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/99_work_star.html-BmUISGj1.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_spring_framework.html-DL226ioX.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_spring_webflux.html-B3xnxX4T.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/3_spring_security.html-CE7pUJxM.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/4_security_sa_token.html-DgqJtrGE.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/5_spring_others.html-BUmFjy3r.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/6_solon_framework.html-Bn0JmCCT.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/z_single_sign_on.html-EFaXu4Xc.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/0_springboot.html-L5V9Dliu.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/1_ web_development.html-aBx65EaX.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/2_data_access.html-MLl5NhuC.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/3_middleware_integration.html-CtdXW_CD.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/4_configuration_management.html-BHmNi6zN.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/5_testing_and_debugging.html-DvzuHy0M.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/6_deployment_and_operations.html-DAkIBJjz.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/7_best_practices_and_patterns.html-kt6-vrI2.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/z_spring_boot_flyway.html-CFYRp6Dm.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/404.html-C43z2aTM.js" as="script"><link rel="prefetch" href="/clarence-java-doc/assets/setupDevtools-7MC2TMWH-Dzq0oQb-.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/clarence-java-doc/"><img class="vp-site-logo" src="/clarence-java-doc/images/logo.png" alt="Clarence Java Doc"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Clarence Java Doc</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/interview/0_java.html" aria-label="开发总结"><!---->开发总结<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/java/1_base.html" aria-label="Java"><!---->Java<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/database/0_mysql.html" aria-label="数据库"><!---->数据库<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/cache/1_redis.html" aria-label="缓存"><!---->缓存<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/jvm/1_jvm_memory_base.html" aria-label="JVM"><!---->JVM<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/spring/1_spring_framework.html" aria-label="Spring"><!---->Spring<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/springboot/0_springboot.html" aria-label="SpringBoot"><!---->SpringBoot<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/microservices/1_base_concept.html" aria-label="微服务"><!---->微服务<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/messaging/1_mq.html" aria-label="消息队列"><!---->消息队列<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/high-con/0_concurrent.html" aria-label="高并发"><!---->高并发<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/distributed/0_distributed.html" aria-label="分布式"><!---->分布式<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/high-avail/0_high_availability.html" aria-label="高可用"><!---->高可用<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/patterns/0_design_intro.html" aria-label="设计模式"><!---->设计模式<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/scenario/0_scene.html" aria-label="场景题"><!---->场景题<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/netty/0_stick_split.html" aria-label="Netty"><!---->Netty<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/cloud-native/1_linux.html" aria-label="云原生"><!---->云原生<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/algorithms/0_base_0_complexity.html" aria-label="算法"><!---->算法<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/architecture/0_system_structure.html" aria-label="架构"><!---->架构<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/protocols/0_protocols_base.html" aria-label="开发协议"><!---->开发协议<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/iot/0_base.html" aria-label="IOT"><!---->IOT<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/ai/0_ai.html" aria-label="人工智能"><!---->人工智能<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/interview/0_java.html" aria-label="开发总结"><!---->开发总结<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/java/1_base.html" aria-label="Java"><!---->Java<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/database/0_mysql.html" aria-label="数据库"><!---->数据库<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/cache/1_redis.html" aria-label="缓存"><!---->缓存<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/jvm/1_jvm_memory_base.html" aria-label="JVM"><!---->JVM<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/spring/1_spring_framework.html" aria-label="Spring"><!---->Spring<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/springboot/0_springboot.html" aria-label="SpringBoot"><!---->SpringBoot<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/microservices/1_base_concept.html" aria-label="微服务"><!---->微服务<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/messaging/1_mq.html" aria-label="消息队列"><!---->消息队列<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/high-con/0_concurrent.html" aria-label="高并发"><!---->高并发<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/distributed/0_distributed.html" aria-label="分布式"><!---->分布式<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/high-avail/0_high_availability.html" aria-label="高可用"><!---->高可用<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/patterns/0_design_intro.html" aria-label="设计模式"><!---->设计模式<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/scenario/0_scene.html" aria-label="场景题"><!---->场景题<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/netty/0_stick_split.html" aria-label="Netty"><!---->Netty<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/cloud-native/1_linux.html" aria-label="云原生"><!---->云原生<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/algorithms/0_base_0_complexity.html" aria-label="算法"><!---->算法<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/architecture/0_system_structure.html" aria-label="架构"><!---->架构<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/protocols/0_protocols_base.html" aria-label="开发协议"><!---->开发协议<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/iot/0_base.html" aria-label="IOT"><!---->IOT<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/clarence-java-doc/ai/0_ai.html" aria-label="人工智能"><!---->人工智能<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/clarence-java-doc/architecture/0_system_structure.html" aria-label="系统架构"><!---->系统架构<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/clarence-java-doc/architecture/1_cold_hot_data.html" aria-label="数据冷热分离"><!---->数据冷热分离<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/clarence-java-doc/architecture/2_database_100_.html" aria-label="DB CPU 100%"><!---->DB CPU 100%<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/clarence-java-doc/architecture/3_team_git_guidelines.html" aria-label="团队 Git 规范"><!---->团队 Git 规范<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/clarence-java-doc/architecture/5_object_storage_service.html" aria-label="OSS 对象存储"><!---->OSS 对象存储<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/clarence-java-doc/architecture/6_idempotence.html" aria-label="幂等 方案总结"><!---->幂等 方案总结<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/clarence-java-doc/architecture/7_team_dev_rule.html" aria-label="团队开发手册"><!---->团队开发手册<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/clarence-java-doc/architecture/8_software_architecture.html" aria-label="软件设计架构"><!---->软件设计架构<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/clarence-java-doc/architecture/9_ddd_architecture.html" aria-label="DDD 领域驱动设计"><!---->DDD 领域驱动设计<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/clarence-java-doc/architecture/a_access_control_model.html" aria-label="访问控制模型"><!---->访问控制模型<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active" href="/clarence-java-doc/architecture/b_log_ten_rule.html" aria-label="打印日志最佳实践"><!---->打印日志最佳实践<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/clarence-java-doc/architecture/c_master_data_manage.html" aria-label="主数据系统设计"><!---->主数据系统设计<!----></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h1 id="打印日志最佳实践" tabindex="-1"><a class="header-anchor" href="#打印日志最佳实践"><span>打印日志最佳实践</span></a></h1><blockquote><p>参考链接： <a href="https://mp.weixin.qq.com/s/Jz3eC3p6tfE3QUPOkw4sTQ" target="_blank" rel="noopener noreferrer">打印优质日志的 10 条军规-苏三说技术</a></p></blockquote><h2 id="第1条-格式统一" tabindex="-1"><a class="header-anchor" href="#第1条-格式统一"><span>第1条：格式统一</span></a></h2><h3 id="反例-管理看到会扣钱" tabindex="-1"><a class="header-anchor" href="#反例-管理看到会扣钱"><span>反例（管理看到会扣钱）</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">log.info(&quot;start process&quot;);</span>
<span class="line">log.error(&quot;error happen&quot;);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>无时间戳，无上下文。</p><h3 id="正解代码" tabindex="-1"><a class="header-anchor" href="#正解代码"><span>正解代码：</span></a></h3><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token comment">&lt;!-- logback.xml核心配置 --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    %d{yy-MM-dd HH:mm:ss.SSS}</span>
<span class="line">    |%X{traceId:-NO_ID}</span>
<span class="line">    |%thread</span>
<span class="line">    |%-5level</span>
<span class="line">    |%logger{36}</span>
<span class="line">    |%msg%n</span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在logback.xml中统一配置了日志的时间格式、tradeId，线程、等级、日志详情都信息。</p><p>日志的格式统一了，更方便点位问题。</p><p><img src="/clarence-java-doc/assets/format-Dru071P1.png" alt="img.png"></p><h2 id="第2条-异常必带堆栈" tabindex="-1"><a class="header-anchor" href="#第2条-异常必带堆栈"><span>第2条：异常必带堆栈</span></a></h2><h3 id="反例-同事看了想打人" tabindex="-1"><a class="header-anchor" href="#反例-同事看了想打人"><span>反例（同事看了想打人）：</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">try {</span>
<span class="line">    processOrder();</span>
<span class="line">} catch (Exception e) {</span>
<span class="line">    log.error(&quot;处理失败&quot;);</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>出现异常了，日志中没打印任何的异常堆栈信息。</p><p>相当于自己把异常吃掉了。 非常不好排查问题。</p><h3 id="正确姿势" tabindex="-1"><a class="header-anchor" href="#正确姿势"><span>正确姿势：</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// e必须存在！</span></span>
<span class="line">log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;订单处理异常 orderId={}&quot;</span><span class="token punctuation">,</span>orderId<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>日志中记录了出现异常的订单号orderId和异常的堆栈信息e。</p><h2 id="第3条-级别合理" tabindex="-1"><a class="header-anchor" href="#第3条-级别合理"><span>第3条：级别合理</span></a></h2><h3 id="反面教材" tabindex="-1"><a class="header-anchor" href="#反面教材"><span>反面教材：</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">// 业务异常应属WARN</span>
<span class="line">log.debug(&quot;用户余额不足 userId={}&quot;, userId); </span>
<span class="line">// 普通超时属INFO</span>
<span class="line">log.error(&quot;接口响应稍慢&quot;);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接口响应稍慢，打印了error级别的日志，显然不太合理。</p><p>正常情况下，普通超时属INFO级别。</p><h3 id="日志级别定义表" tabindex="-1"><a class="header-anchor" href="#日志级别定义表"><span>日志级别定义表</span></a></h3><table><thead><tr><th>级别</th><th>正确使用场景</th></tr></thead><tbody><tr><td>FATAL</td><td>系统即将崩溃（如 OOM、磁盘爆满）</td></tr><tr><td>ERROR</td><td>核心业务失败（如支付失败、订单创建异常）</td></tr><tr><td>WARN</td><td>可恢复异常（如重试成功、触发降级）</td></tr><tr><td>INFO</td><td>关键流程节点（如订单状态变更、接口响应稍慢）</td></tr><tr><td>DEBUG</td><td>调试信息（如参数流水、中间结果）</td></tr></tbody></table><h2 id="第4条-参数完整" tabindex="-1"><a class="header-anchor" href="#第4条-参数完整"><span>第4条：参数完整</span></a></h2><h3 id="反例-让运维骂娘" tabindex="-1"><a class="header-anchor" href="#反例-让运维骂娘"><span>反例（让运维骂娘）：</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;用户登录失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>上面这个日志只打印了“用户登录失败”这个文案。</p><p>谁在哪登录失败？</p><h3 id="侦探式日志" tabindex="-1"><a class="header-anchor" href="#侦探式日志"><span>侦探式日志：</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;用户登录失败 username={}, clientIP={}, failReason={}&quot;</span><span class="token punctuation">,</span></span>
<span class="line">         username<span class="token punctuation">,</span> clientIP<span class="token punctuation">,</span> <span class="token string">&quot;密码错误次数超限&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>登录失败的业务场景，需要记录哪个用户，ip是多少，在什么时间，登录失败了，失败的原因是什么。</p><p>时间在logback.xml中统一配置了格式。</p><p>这样才方便快速定位问题：</p><p><img src="/clarence-java-doc/assets/full_param-Kb69qkTi.png" alt="img.png"></p><h2 id="第5条-数据脱敏" tabindex="-1"><a class="header-anchor" href="#第5条-数据脱敏"><span>第5条：数据脱敏</span></a></h2><h3 id="血泪案例" tabindex="-1"><a class="header-anchor" href="#血泪案例"><span>血泪案例：</span></a></h3><p>某同事打印日志泄露用户手机号被投诉。</p><p>我在记录的日志中，需要对一下用户的个人敏感数据做脱敏处理。</p><p>例如下面这样：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">// 脱敏工具类</span>
<span class="line">public class LogMasker {</span>
<span class="line">    public static String maskMobile(String mobile) {</span>
<span class="line">        return mobile.replaceAll(&quot;(\\d{3})\\d{4}(\\d{4})&quot;, &quot;$1****$2&quot;);</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">// 使用示例</span>
<span class="line">log.info(&quot;用户注册 mobile={}&quot;, LogMasker.maskMobile(&quot;13812345678&quot;));</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="第6条-异步保性能" tabindex="-1"><a class="header-anchor" href="#第6条-异步保性能"><span>第6条：异步保性能</span></a></h2><h3 id="问题复现" tabindex="-1"><a class="header-anchor" href="#问题复现"><span>问题复现</span></a></h3><p>某次秒杀活动中直接同步写日志，导致大量线程阻塞：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;秒杀请求 userId={}, itemId={}&quot;</span><span class="token punctuation">,</span>userId<span class="token punctuation">,</span> itemId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>高并发下IO阻塞。</p><h3 id="致命伤害分析" tabindex="-1"><a class="header-anchor" href="#致命伤害分析"><span>致命伤害分析：</span></a></h3><ul><li>同步写日志导致线程上下文切换频繁</li><li>磁盘IO成为系统瓶颈</li><li>高峰期日志打印耗时占总RT的25%</li></ul><h3 id="正确示范-三步配置法" tabindex="-1"><a class="header-anchor" href="#正确示范-三步配置法"><span>正确示范（三步配置法）</span></a></h3><h4 id="步骤1-logback-xml配置异步通道" tabindex="-1"><a class="header-anchor" href="#步骤1-logback-xml配置异步通道"><span>步骤1：logback.xml配置异步通道</span></a></h4><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token comment">&lt;!-- 异步Appender核心配置 --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ASYNC<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.classic.AsyncAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token comment">&lt;!-- 不丢失日志的阈值：当队列剩余容量＜此值时，TRACE/DEBUG级别日志将被丢弃 --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>discardingThreshold</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>discardingThreshold</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token comment">&lt;!-- 队列深度：建议设为 (最大并发线程数 × 2) --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>queueSize</span><span class="token punctuation">&gt;</span></span>4096<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>queueSize</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token comment">&lt;!-- 关联真实Appender --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FILE<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span> </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤2-日志输出优化代码" tabindex="-1"><a class="header-anchor" href="#步骤2-日志输出优化代码"><span>步骤2：日志输出优化代码</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">// 无需前置判断，框架自动处理  </span>
<span class="line">// 自动异步写入队列</span>
<span class="line">log.debug(&quot;接收到MQ消息：{}&quot;, msg.toSimpleString());</span>
<span class="line"></span>
<span class="line">// 不应做复杂计算后再打印（异步前仍在业务线程执行）  </span>
<span class="line">// 错误做法：  </span>
<span class="line">log.debug(&quot;详细内容：{}&quot;, computeExpensiveLog());</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>流程图如下： <img src="/clarence-java-doc/assets/log_output-wpk29wpi.png" alt="img.png"></p><h4 id="步骤3-性能关键参数公式" tabindex="-1"><a class="header-anchor" href="#步骤3-性能关键参数公式"><span>步骤3：性能关键参数公式</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">最大内存占用 ≈ 队列长度 × 平均单条日志大小  </span>
<span class="line">推荐队列深度 = 峰值TPS × 容忍最大延迟(秒)  </span>
<span class="line">例如：10000 TPS × 0.5s容忍 ⇒ 5000队列大小 </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="风险规避策略" tabindex="-1"><a class="header-anchor" href="#风险规避策略"><span>风险规避策略</span></a></h3><ul><li>防队列堆积：监控队列使用率，达80%触发告警</li><li>防OOM：严格约束大对象toString()的调用</li><li>紧急逃生：预设JMX接口用于快速切换同步模式</li></ul><h2 id="第7条-链路追踪" tabindex="-1"><a class="header-anchor" href="#第7条-链路追踪"><span>第7条：链路追踪</span></a></h2><h3 id="混沌场景" tabindex="-1"><a class="header-anchor" href="#混沌场景"><span>混沌场景：</span></a></h3><p>跨服务调用无法关联日志。</p><p>我们需要有链路追踪方案。</p><h3 id="全链路方案" tabindex="-1"><a class="header-anchor" href="#全链路方案"><span>全链路方案：</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">// 拦截器注入traceId</span>
<span class="line">MDC.put(&quot;traceId&quot;, UUID.randomUUID().toString().substring(0,8));</span>
<span class="line"></span>
<span class="line">// 日志格式包含traceId</span>
<span class="line">&lt;pattern&gt;%d{HH:mm:ss} |%X{traceId}| %msg%n&lt;/pattern&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以在MDC中设置traceId。</p><p>后面可以通过traceId全链路追踪日志。</p><p>流程图如下：</p><p><img src="/clarence-java-doc/assets/chain_watch-C1IXlh66.png" alt="img.png"></p><h2 id="第8条-动态调参" tabindex="-1"><a class="header-anchor" href="#第8条-动态调参"><span>第8条：动态调参</span></a></h2><h3 id="半夜重启的痛" tabindex="-1"><a class="header-anchor" href="#半夜重启的痛"><span>半夜重启的痛：</span></a></h3><p>线上问题需要临时开DEBUG日志，比如：查询用户的某次异常操作的日志。</p><h3 id="热更新方案" tabindex="-1"><a class="header-anchor" href="#热更新方案"><span>热更新方案：</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"></span>
<span class="line"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/logLevel&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">changeLogLevel</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> loggerName<span class="token punctuation">,</span></span>
<span class="line">        <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> level<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Logger</span><span class="token punctuation">)</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>loggerName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    logger<span class="token punctuation">.</span><span class="token function">setLevel</span><span class="token punctuation">(</span><span class="token class-name">Level</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 立即生效</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&quot;OK&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>有时候我们需要临时打印DEBUG日志，这就需要有个动态参数控制了。</p><p>否则每次调整打印日志级别都需要重启服务，可能会影响用户的正常使用。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">journey</span>
<span class="line">    title 日志级别动态调整</span>
<span class="line">    section 旧模式</span>
<span class="line">        发现问题 --&gt; 修改配置 --&gt; 重启应用 --&gt; 丢失现场</span>
<span class="line">    section 新模式</span>
<span class="line">        发现问题 --&gt; 动态调整 --&gt; 立即生效 --&gt; 保持现场</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="第9条-结构化存储" tabindex="-1"><a class="header-anchor" href="#第9条-结构化存储"><span>第9条：结构化存储</span></a></h2><h3 id="混沌日志" tabindex="-1"><a class="header-anchor" href="#混沌日志"><span>混沌日志：</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">用户购买了苹果手机 订单号1001 金额8999</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>上面的日志拼接成了一个字符串，虽说中间有空格分隔了，但哪些字段对应了哪些值，看起来不是很清楚。</p><p>我们在存储日志的时候，需要做结构化存储，方便快速的查询和搜索。</p><h3 id="机器友好式日志" tabindex="-1"><a class="header-anchor" href="#机器友好式日志"><span>机器友好式日志：</span></a></h3><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;event&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ORDER_CREATE&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;orderId&quot;</span><span class="token operator">:</span> <span class="token number">1001</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;amount&quot;</span><span class="token operator">:</span> <span class="token number">8999</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;products&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;iPhone&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;sku&quot;</span><span class="token operator">:</span> <span class="token string">&quot;A123&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里使用了json格式存储日志。</p><p>日志中的数据一目了然。</p><h2 id="第10条-智能监控" tabindex="-1"><a class="header-anchor" href="#第10条-智能监控"><span>第10条：智能监控</span></a></h2><h3 id="最失败案例" tabindex="-1"><a class="header-anchor" href="#最失败案例"><span>最失败案例：</span></a></h3><p>某次用户开通会员操作，错误日志堆积3天才被发现，黄花菜都凉了。</p><p>我们需要在项目中引入智能监控。</p><h3 id="elk监控方案" tabindex="-1"><a class="header-anchor" href="#elk监控方案"><span>ELK监控方案：</span></a></h3><p><img src="/clarence-java-doc/assets/elk-BCAhFRWJ.png" alt="img.png"></p><h3 id="报警规则示例" tabindex="-1"><a class="header-anchor" href="#报警规则示例"><span>报警规则示例：</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">ERROR日志连续5分钟 &gt; 100条 → 电话告警  </span>
<span class="line">WARN日志持续1小时 → 邮件通知</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="日志方案总结" tabindex="-1"><a class="header-anchor" href="#日志方案总结"><span>日志方案总结</span></a></h2><p>研发人员的三大境界：</p><p>青铜：System.out.println(&quot;error！&quot;)</p><p>钻石：标准化日志 + ELK监控</p><p>王者：</p><ul><li>日志驱动代码优化</li><li>异常预测系统</li><li>根因分析AI模型</li></ul><p>最后的灵魂拷问：</p><p><strong>下次线上故障时，你的日志能让新人5分钟定位问题吗？</strong></p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1154937362@qq.com">hello0709</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 1154937362@qq.com">Clarence</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/clarence-java-doc/architecture/a_access_control_model.html" aria-label="访问控制模型"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>访问控制模型</span></div></a><a class="route-link auto-link next" href="/clarence-java-doc/architecture/c_master_data_manage.html" aria-label="主数据系统设计"><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>主数据系统设计</span></div></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/clarence-java-doc/assets/app-Du6cbhZk.js" defer></script>
  </body>
</html>
